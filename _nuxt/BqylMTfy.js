const P=[[/^(<!--)(.+)(-->)$/,!1],[/^(\/\*)(.+)(\*\/)$/,!1],[/^(\/\/|["'#]|;{1,2}|%{1,2}|--)(.*)$/,!0],[/^(\*)(.+)$/,!0]];function j(e,s){if(e.type!=="element")return!1;const i=e.children[0];return i.type==="text"&&i.value.trim()===s}function L(e,s){let i=e.trimStart();const l=e.length-i.length;i=i.trimEnd();const a=e.length-i.length-l;for(const[x,k]of P){if(k&&!s)continue;const g=x.exec(i);if(g)return[" ".repeat(l)+g[1],g[2],g[3]?g[3]+" ".repeat(a):void 0]}}function $(e){const s=e.match(/(?:\/\/|["'#]|;{1,2}|%{1,2}|--)(\s*)$/);return s&&s[1].trim().length===0?e.slice(0,s.index):e}function N(e,s,i,l){return l==null&&(l="v3"),{name:e,code(a){const x=a.children.filter(t=>t.type==="element"),k=[];a.data??={};const g=a.data;g._shiki_notation??=(function(t,d,u){const r=[];for(const n of t){if(u==="v3"){const h=n.children.flatMap((o,y)=>{if(o.type!=="element")return o;const A=o.children[0];if(A.type!=="text")return o;const C=y===n.children.length-1;if(!L(A.value,C))return o;const m=A.value.split(/(\s+\/\/)/);if(m.length<=1)return o;let f=[m[0]];for(let p=1;p<m.length;p+=2)f.push(m[p]+(m[p+1]||""));return f=f.filter(Boolean),f.length<=1?o:f.map(p=>({...o,children:[{type:"text",value:p}]}))});h.length!==n.children.length&&(n.children=h)}const c=n.children;let v=c.length-1;u==="v1"?v=0:d&&(v=c.length-2);for(let h=Math.max(v,0);h<c.length;h++){const o=c[h];if(o.type!=="element")continue;const y=o.children.at(0);if(y?.type!=="text")continue;const A=h===c.length-1;let C,m=L(y.value,A);if(!m&&h>0&&y.value.trim().startsWith("[!code")){const f=c[h-1];if(f?.type==="element"){const p=f.children.at(0);if(p?.type==="text"&&p.value.includes("//")){const O=L(p.value+y.value,A);if(O){m=O,r.push({info:O,line:n,token:f,isLineCommentOnly:c.length===2&&f.children.length===1&&o.children.length===1,isJsxStyle:!1,additionalTokens:[o]});continue}}}}if(m)if(d&&!A&&h!==0){const f=j(c[h-1],"{")&&j(c[h+1],"}");r.push({info:m,line:n,token:o,isLineCommentOnly:c.length===3&&o.children.length===1,isJsxStyle:f,additionalTokens:C})}else r.push({info:m,line:n,token:o,isLineCommentOnly:c.length===1&&o.children.length===1,isJsxStyle:!1,additionalTokens:C})}}return r})(x,["jsx","tsx"].includes(this.options.lang),l);const M=g._shiki_notation;for(const t of M){if(t.info[1].length===0)continue;let d=x.indexOf(t.line);t.isLineCommentOnly&&l!=="v1"&&d++;let u=!1;if(t.info[1]=t.info[1].replace(s,(...n)=>i.call(this,n,t.line,t.token,x,d)?(u=!0,""):n[0]),!u)continue;l==="v1"&&(t.info[1]=$(t.info[1]));const r=t.info[1].trim().length===0;if(r&&(t.info[1]=""),r&&t.isLineCommentOnly)k.push(t.line);else if(r&&t.isJsxStyle)t.line.children.splice(t.line.children.indexOf(t.token)-1,3);else if(r){if(t.additionalTokens)for(let n=t.additionalTokens.length-1;n>=0;n--){const c=t.additionalTokens[n],v=t.line.children.indexOf(c);v!==-1&&t.line.children.splice(v,1)}t.line.children.splice(t.line.children.indexOf(t.token),1)}else{const n=t.token.children[0];if(n.type==="text"&&(n.value=t.info.join(""),t.additionalTokens))for(const c of t.additionalTokens){const v=c.children[0];v?.type==="text"&&(v.value="")}}}for(const t of k){const d=a.children.indexOf(t),u=a.children[d+1];let r=1;u?.type==="text"&&u?.value===`
`&&(r=2),a.children.splice(d,r)}}}}function S(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function T(e={},s="@shikijs/transformers:notation-map"){const{classMap:i={},classActivePre:l,classActiveCode:a}=e;return N(s,new RegExp(`#?\\s*\\[!code (${Object.keys(i).map(S).join("|")})(:\\d+)?\\]`,"gi"),function([x,k,g=":1"],M,t,d,u){const r=Number.parseInt(g.slice(1),10);for(let n=u;n<Math.min(u+r,d.length);n++)this.addClassToHast(d[n],i[k]);return l&&this.addClassToHast(this.pre,l),a&&this.addClassToHast(this.code,a),!0},e.matchAlgorithm)}function H(e={}){const{classLineAdd:s="diff add",classLineRemove:i="diff remove",classActivePre:l="has-diff",classActiveCode:a}=e;return T({classMap:{"++":s,"--":i},classActivePre:l,classActiveCode:a,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-diff")}function J(e={}){const{classMap:s={error:["highlighted","error"],warning:["highlighted","warning"]},classActivePre:i="has-highlighted",classActiveCode:l}=e;return T({classMap:s,classActivePre:i,classActiveCode:l,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-error-level")}function _(e={}){const{classActiveLine:s="focused",classActivePre:i="has-focused",classActiveCode:l}=e;return T({classMap:{focus:s},classActivePre:i,classActiveCode:l,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-focus")}function w(e={}){const{classActiveLine:s="highlighted",classActivePre:i="has-highlighted",classActiveCode:l}=e;return T({classMap:{highlight:s,hl:s},classActivePre:i,classActiveCode:l,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-highlight")}export{N as createCommentNotationTransformer,H as transformerNotationDiff,J as transformerNotationErrorLevel,_ as transformerNotationFocus,w as transformerNotationHighlight,T as transformerNotationMap};
