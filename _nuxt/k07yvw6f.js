const y=[[/^(<!--)(.+)(-->)$/,!1],[/^(\/\*)(.+)(\*\/)$/,!1],[/^(\/\/|["'#]|;{1,2}|%{1,2}|--)(.*)$/,!0],[/^(\*)(.+)$/,!0]];function L(n,i,t){const a=[];for(const c of n){if(t==="v3"){const s=c.children.flatMap((l,e)=>{if(l.type!=="element")return l;const f=l.children[0];if(f.type!=="text")return l;const h=e===c.children.length-1;if(!k(f.value,h))return l;const o=f.value.split(/(\s+\/\/)/);if(o.length<=1)return l;let m=[o[0]];for(let u=1;u<o.length;u+=2)m.push(o[u]+(o[u+1]||""));return m=m.filter(Boolean),m.length<=1?l:m.map(u=>({...l,children:[{type:"text",value:u}]}))});s.length!==c.children.length&&(c.children=s)}const r=c.children;let g=r.length-1;t==="v1"?g=0:i&&(g=r.length-2);for(let s=Math.max(g,0);s<r.length;s++){const l=r[s];if(l.type!=="element")continue;const e=l.children.at(0);if(e?.type!=="text")continue;const f=s===r.length-1;let h=k(e.value,f),d;if(!h&&s>0&&e.value.trim().startsWith("[!code")){const o=r[s-1];if(o?.type==="element"){const m=o.children.at(0);if(m?.type==="text"&&m.value.includes("//")){const u=m.value+e.value,v=k(u,f);if(v){h=v,a.push({info:v,line:c,token:o,isLineCommentOnly:r.length===2&&o.children.length===1&&l.children.length===1,isJsxStyle:!1,additionalTokens:[l]});continue}}}}if(h)if(i&&!f&&s!==0){const o=x(r[s-1],"{")&&x(r[s+1],"}");a.push({info:h,line:c,token:l,isLineCommentOnly:r.length===3&&l.children.length===1,isJsxStyle:o,additionalTokens:d})}else a.push({info:h,line:c,token:l,isLineCommentOnly:r.length===1&&l.children.length===1,isJsxStyle:!1,additionalTokens:d})}}return a}function x(n,i){if(n.type!=="element")return!1;const t=n.children[0];return t.type!=="text"?!1:t.value.trim()===i}function k(n,i){let t=n.trimStart();const a=n.length-t.length;t=t.trimEnd();const c=n.length-t.length-a;for(const[r,g]of y){if(g&&!i)continue;const s=r.exec(t);if(s)return[" ".repeat(a)+s[1],s[2],s[3]?s[3]+" ".repeat(c):void 0]}}function T(n){const i=n.match(/(?:\/\/|["'#]|;{1,2}|%{1,2}|--)(\s*)$/);return i&&i[1].trim().length===0?n.slice(0,i.index):n}function C(n,i,t,a){return a==null&&(a="v3"),{name:n,code(c){const r=c.children.filter(e=>e.type==="element"),g=[];c.data??={};const s=c.data;s._shiki_notation??=L(r,["jsx","tsx"].includes(this.options.lang),a);const l=s._shiki_notation;for(const e of l){if(e.info[1].length===0)continue;let f=r.indexOf(e.line);e.isLineCommentOnly&&a!=="v1"&&f++;let h=!1;if(e.info[1]=e.info[1].replace(i,(...o)=>t.call(this,o,e.line,e.token,r,f)?(h=!0,""):o[0]),!h)continue;a==="v1"&&(e.info[1]=T(e.info[1]));const d=e.info[1].trim().length===0;if(d&&(e.info[1]=""),d&&e.isLineCommentOnly)g.push(e.line);else if(d&&e.isJsxStyle)e.line.children.splice(e.line.children.indexOf(e.token)-1,3);else if(d){if(e.additionalTokens)for(let o=e.additionalTokens.length-1;o>=0;o--){const m=e.additionalTokens[o],u=e.line.children.indexOf(m);u!==-1&&e.line.children.splice(u,1)}e.line.children.splice(e.line.children.indexOf(e.token),1)}else{const o=e.token.children[0];if(o.type==="text"&&(o.value=e.info.join(""),e.additionalTokens))for(const m of e.additionalTokens){const u=m.children[0];u?.type==="text"&&(u.value="")}}}for(const e of g){const f=c.children.indexOf(e),h=c.children[f+1];let d=1;h?.type==="text"&&h?.value===`
`&&(d=2),c.children.splice(f,d)}}}}function A(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function p(n={},i="@shikijs/transformers:notation-map"){const{classMap:t={},classActivePre:a=void 0}=n;return C(i,new RegExp(`#?\\s*\\[!code (${Object.keys(t).map(A).join("|")})(:\\d+)?\\]`,"gi"),function([c,r,g=":1"],s,l,e,f){const h=Number.parseInt(g.slice(1),10);for(let d=f;d<Math.min(f+h,e.length);d++)this.addClassToHast(e[d],t[r]);return a&&this.addClassToHast(this.pre,a),!0},n.matchAlgorithm)}function O(n={}){const{classLineAdd:i="diff add",classLineRemove:t="diff remove",classActivePre:a="has-diff"}=n;return p({classMap:{"++":i,"--":t},classActivePre:a,matchAlgorithm:n.matchAlgorithm},"@shikijs/transformers:notation-diff")}function M(n={}){const{classMap:i={error:["highlighted","error"],warning:["highlighted","warning"]},classActivePre:t="has-highlighted"}=n;return p({classMap:i,classActivePre:t,matchAlgorithm:n.matchAlgorithm},"@shikijs/transformers:notation-error-level")}function j(n={}){const{classActiveLine:i="focused",classActivePre:t="has-focused"}=n;return p({classMap:{focus:i},classActivePre:t,matchAlgorithm:n.matchAlgorithm},"@shikijs/transformers:notation-focus")}function E(n={}){const{classActiveLine:i="highlighted",classActivePre:t="has-highlighted"}=n;return p({classMap:{highlight:i,hl:i},classActivePre:t,matchAlgorithm:n.matchAlgorithm},"@shikijs/transformers:notation-highlight")}export{C as createCommentNotationTransformer,O as transformerNotationDiff,M as transformerNotationErrorLevel,j as transformerNotationFocus,E as transformerNotationHighlight,p as transformerNotationMap};
