---
title: 数据库
description: Nuxt Content 如何存储和检索内容
navigation:
  title: SQL 存储
---

在 Content v3 中，我们引入了基于 SQLite 的强大存储层，提供了一种强大且高效的内容管理方法。这相比之前基于文件的存储系统是一个显著的提升，后者在性能和可扩展性方面存在局限。

> 在 Content v2 中，系统在 Nitro 运行时读取并解析内容，为每个内容文件创建缓存文件以存储解析数据。这种方法给网站运行时带来了相当大的开销。
>
> - 生产环境中的 I/O 时间较长，因为模块必须加载所有缓存文件来搜索内容。
> - 此外，由于内容缺乏优化和压缩，导致包体积较大，特别在边缘环境中表现尤为明显。

Content v3 的内容管理包含三个关键步骤，旨在简化流程并提升性能。

## 生成数据库转储文件

对于项目中的每个集合，模块从定义的源读取内容并解析成抽象语法树（AST）。基于集合的模式为每个集合创建特定的表。然后将解析后的内容插入对应的表中，确保数据结构与定义的模式一致，以实现最佳查询效果。所有内容最终保存到转储文件中。

## 冷启动时还原转储文件

在运行时，当应用执行首次内容查询时，模块会读取前一步生成的转储文件，并将其还原到目标数据库中。该过程快速且针对不同部署模式和平台进行了优化。

模块采用了特殊的完整性检查机制，确保数据库内容更新到最新状态。该完整性检查机制还能防止重复导入，保持数据存储的完整性和准确性。

## 浏览器中的 WASM SQLite

针对客户端导航，模块采用类似的方法。当应用执行首次内容查询时，会从服务器下载生成的转储文件，并在浏览器中初始化本地 SQLite 数据库。从此之后，所有查询均在本地执行，无需调用服务器，大大提升了应用响应速度并提供无缝用户体验。

这一架构不仅提升了性能，还支持离线功能，使用户即使在无网络连接时也能访问内容。服务器端与客户端的结合确保 Nuxt Content v3 功能强大且灵活，适用于广泛的用例和环境。