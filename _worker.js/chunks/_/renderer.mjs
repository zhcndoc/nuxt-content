import{cn as e,co as t,a8 as r,cp as n,ch as i,cq as a,ab as o,cr as s,aa as u,h as f,ae as c,cs as m,ad as v,ct as T}from"../nitro/nitro.mjs";import{a as P,l as E}from"./eventHandlers.mjs";import"node:buffer";import"node:events";import"node:process";import"node:timers";import"node:async_hooks";import"cloudflare:workers";import"node:path";const N={instance:void 0},$={instance:void 0},j={instance:void 0};async function useSatori(){return j.instance=j.instance||await import("./node.mjs").then(e=>e.default),await j.instance.initWasmPromise,j.instance.satori}var G=new Set(["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),D=new Set(["script","style"]),U=/(?:<(\/?)([a-zA-Z][a-zA-Z0-9\:-]*)(?:\s([^>]*?))?((?:\s*\/)?)>|(<\!\-\-)([\s\S]*?)(\-\->)|(<\!)([\s\S]*?)(>))/gm,q=/[\@\.a-z0-9_\:\-]/i;function I$1(e){let t={};if(e){let r,n,i,a="none",o="";for(let s=0;s<e.length;s++){let u=e[s];"none"===a?q.test(u)?(r&&(t[r]=o,r=void 0,o=""),n=s,a="key"):"="===u&&r&&(a="value"):"key"===a?q.test(u)||(r=e.substring(n,s),a="="===u?"value":"none"):u===i&&s>0&&"\\"!==e[s-1]?i&&(o=e.substring(n,s),i=void 0,a="none"):('"'===u||"'"===u)&&!i&&(n=s+1,i=u)}"key"===a&&null!=n&&n<e.length&&(r=e.substring(n,e.length)),r&&(t[r]=o)}return t}var Z=class{constructor(e){this.callback=e}visit(e,t,r){if(this.callback(e,t,r),Array.isArray(e.children))for(let t=0;t<e.children.length;t++){let r=e.children[t];this.visit(r,e,t)}}},ee=Symbol("HTMLString"),le=Symbol("AttrString");function E$1(e,t=[ee]){let r={value:e};for(let e of t)Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1});return r}var ce={"&":"&amp;","<":"&lt;",">":"&gt;"};function y(e){return e.replace(/[&<>]/g,e=>ce[e]||e)}function N$2(e){let t="";for(let[r,n]of Object.entries(e))t+=` ${r}="${n}"`;return E$1(t,[ee,le])}function H$1(e,...t){let r="";for(let n=0;n<e.length;n++){r+=e[n];let i=t[n];r.endsWith("...")&&i&&"object"==typeof i?(r=r.slice(0,-3).trimEnd(),r+=N$2(i).value):i&&i[le]?(r=r.trimEnd(),r+=i.value):i&&i[ee]?r+=i.value:"string"==typeof i?r+=y(i):(i||0===i)&&(r+=String(i))}return E$1(r)}function B$1(e,t){return new Z(t).visit(e)}var he={attribute:/\[\s*(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?(?<name>[-\w\P{ASCII}]+)\s*(?:(?<operator>\W?=)\s*(?<value>.+?)\s*(\s(?<caseSensitive>[iIsS]))?\s*)?\]/gu,id:/#(?<name>[-\w\P{ASCII}]+)/gu,class:/\.(?<name>[-\w\P{ASCII}]+)/gu,comma:/\s*,\s*/g,combinator:/\s*[\s>+~]\s*/g,"pseudo-element":/::(?<name>[-\w\P{ASCII}]+)(?:\((?<argument>¶*)\))?/gu,"pseudo-class":/:(?<name>[-\w\P{ASCII}]+)(?:\((?<argument>¶*)\))?/gu,universal:/(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?\*/gu,type:/(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?(?<name>[-\w\P{ASCII}]+)/gu},ge=new Set(["combinator","comma"]),we=new Set(["not","is","where","has","matches","-moz-any","-webkit-any","nth-child","nth-last-child"]),Ie=/(?<index>[\dn+-]+)\s+of\s+(?<subtree>.+)/,ke={"nth-child":Ie,"nth-last-child":Ie},T$1=e=>{switch(e){case"pseudo-element":case"pseudo-class":return new RegExp(he[e].source.replace("(?<argument>¶*)","(?<argument>.*)"),"gu");default:return he[e]}};function M$1(e,t){let r=0,n="";for(;t<e.length;t++){let i=e[t];switch(i){case"(":++r;break;case")":--r}if(n+=i,0===r)return n}return n}var Pe=/(['"])([^\\\n]+?)\1/g,Oe=/\\./g;function U$1(e,t=he){if(""===(e=e.trim()))return[];let r=[];e=(e=e.replace(Oe,(e,t)=>(r.push({value:e,offset:t}),"".repeat(e.length)))).replace(Pe,(e,t,n,i)=>(r.push({value:e,offset:i}),`${t}${"".repeat(n.length)}${t}`));{let t,n=0;for(;(t=e.indexOf("(",n))>-1;){let i=M$1(e,t);r.push({value:i,offset:t}),e=`${e.substring(0,t)}(${"¶".repeat(i.length-2)})${e.substring(t+i.length)}`,n=t+i.length}}let n=function(e,t=he){if(!e)return[];let r=[e];for(let[e,n]of Object.entries(t))for(let t=0;t<r.length;t++){let i=r[t];if("string"!=typeof i)continue;n.lastIndex=0;let a=n.exec(i);if(!a)continue;let o=a.index-1,s=[],u=a[0],f=i.slice(0,o+1);f&&s.push(f),s.push({...a.groups,type:e,content:u});let c=i.slice(o+u.length+1);c&&s.push(c),r.splice(t,1,...s)}let n=0;for(let e of r)switch(typeof e){case"string":throw new Error(`Unexpected sequence ${e} found at index ${n}`);case"object":n+=e.content.length,e.pos=[n-e.content.length,n],ge.has(e.type)&&(e.content=e.content.trim()||" ")}return r}(e,t),i=new Set;for(let e of r.reverse())for(let t of n){let{offset:r,value:n}=e;if(!(t.pos[0]<=r&&r+n.length<=t.pos[1]))continue;let{content:a}=t,o=r-t.pos[0];t.content=a.slice(0,o)+n+a.slice(o+n.length),t.content!==a&&i.add(t)}for(let e of i){let t=T$1(e.type);if(!t)throw new Error(`Unknown token type: ${e.type}`);t.lastIndex=0;let r=t.exec(e.content);if(!r)throw new Error(`Unable to parse content for ${e.type}: ${e.content}`);Object.assign(e,r.groups)}return n}function g(e,{list:t=!0}={}){if(t&&e.find(e=>"comma"===e.type)){let t=[],r=[];for(let n=0;n<e.length;n++)if("comma"===e[n].type){if(0===r.length)throw new Error("Incorrect comma at "+n);t.push(g(r,{list:!1})),r.length=0}else r.push(e[n]);if(0===r.length)throw new Error("Trailing comma");return t.push(g(r,{list:!1})),{type:"list",list:t}}for(let t=e.length-1;t>=0;t--){let r=e[t];if("combinator"===r.type){let n=e.slice(0,t),i=e.slice(t+1);return{type:"complex",combinator:r.content,left:g(n),right:g(i)}}}switch(e.length){case 0:throw new Error("Could not build AST.");case 1:return e[0];default:return{type:"compound",list:[...e]}}}function*p(e,t){switch(e.type){case"list":for(let t of e.list)yield*p(t,e);break;case"complex":yield*p(e.left,e),yield*p(e.right,e);break;case"compound":yield*e.list.map(t=>[t,e]);break;default:yield[e,t]}}function b(e,{recursive:t=!0,list:r=!0}={}){let n=U$1(e);if(!n)return;let i=g(n,{list:r});if(!t)return i;for(let[e]of p(i)){if("pseudo-class"!==e.type||!e.argument||!we.has(e.name))continue;let t=e.argument,r=ke[e.name];if(r){let n=r.exec(t);if(!n)continue;Object.assign(e,n.groups),t=n.groups.subtree}t&&Object.assign(e,{subtree:b(t,{recursive:!0,list:!0})})}return i}function x(e,t){return t=t||Math.max(...e)+1,e[0]*(t<<1)+e[1]*t+e[2]}function N$1(e){let t=e;if("string"==typeof t&&(t=b(t,{recursive:!0})),!t)return[];if("list"===t.type&&"list"in t){let e=10,r=t.list.map(t=>{let r=N$1(t);return e=Math.max(e,...N$1(t)),r}),n=r.map(t=>x(t,e));return r[n.indexOf(Math.max(...n))]}let r=[0,0,0];for(let[e]of p(t))switch(e.type){case"id":r[0]++;break;case"class":case"attribute":r[1]++;break;case"pseudo-element":case"type":r[2]++;break;case"pseudo-class":if("where"===e.name)break;if(!we.has(e.name)||!e.subtree){r[1]++;break}N$1(e.subtree).forEach((e,t)=>r[t]+=e),"nth-child"!==e.name&&"nth-last-child"!==e.name||r[1]++}return r}function G$1(e){return x(N$1(e),10)}function R$1(e,t){let r=d(t);return function(e,t,r={single:!1}){let n=[];return B$1(e,(e,i,a)=>{if((!e||1===e.type)&&t(e,i,a)){if(r.single)throw e;n.push(e)}}),n}(e,(e,t,n)=>r(e,t,n)||!1)}var L$1=e=>{let{operator:t="="}=e;switch(t){case"=":return(e,t)=>e===t;case"~=":return(e,t)=>e.split(/\s+/g).includes(t);case"|=":return(e,t)=>e.startsWith(t+"-");case"*=":return(e,t)=>e.indexOf(t)>-1;case"$=":return(e,t)=>e.endsWith(t);case"^=":return(e,t)=>e.startsWith(t)}return(e,t)=>!1},I=(e,t)=>null==t?void 0:t.children.filter(e=>1===e.type).findIndex(t=>t===e),S$1=e=>{switch(e.type){case"type":return t=>"*"===e.content||t.name===e.name;case"class":return t=>{var r,n;return null==(n=null==(r=t.attributes)?void 0:r.class)?void 0:n.split(/\s+/g).includes(e.name)};case"id":return t=>{var r;return(null==(r=t.attributes)?void 0:r.id)===e.name};case"pseudo-class":switch(e.name){case"global":return(...t)=>d(b(e.argument))(...t);case"not":return(...t)=>!S$1(e.subtree)(...t);case"is":case"where":return(...t)=>d(e.subtree)(...t);case"root":return(e,t)=>1===e.type&&"html"===e.name;case"empty":return e=>1===e.type&&(0===e.children.length||e.children.every(e=>2===e.type&&""===e.value.trim()));case"first-child":return(e,t)=>((e,t)=>(null==t?void 0:t.children.filter(e=>1===e.type).shift())===e)(e,t);case"last-child":return(e,t)=>((e,t)=>(null==t?void 0:t.children.filter(e=>1===e.type).pop())===e)(e,t);case"only-child":return(e,t)=>((e,t)=>1===(null==t?void 0:t.children.filter(e=>1===e.type).length))(0,t);case"nth-child":return(t,r)=>{let n=I(t,r)+1;if(Number.isNaN(Number(e.argument)))switch(e.argument){case"odd":return 1==Math.abs(n%2);case"even":return n%2==0;default:{if(!e.argument)throw new Error("Unsupported empty nth-child selector!");let n=(e=>{let[t,r="1",n="0"]=/^\s*(?:(-?(?:\d+)?)n)?\s*\+?\s*(\d+)?\s*$/gm.exec(e)??[];0===r.length&&(r="1");let i=Number.parseInt("-"===r?"-1":r),a=Number.parseInt(n);return e=>i*e+a})(e.argument),i=null==r?void 0:r.children.filter(e=>1===e.type),a=I(t,r)+1;for(let e=0;e<i.length;e++){let t=n(e);if(t>i.length)return!1;if(t===a)return!0}return!1}}return n===Number(e.argument)};default:throw new Error(`Unhandled pseudo-class: ${e.name}!`)}case"attribute":return t=>{let{caseSensitive:r,name:n,value:i}=e;if(!t.attributes)return!1;let a=Object.entries(t.attributes);for(let[t,o]of a)if("i"===r&&(i=n.toLowerCase(),o=t.toLowerCase()),t===n){if(!i)return!0;if(('"'===i[0]||"'"===i[0])&&i[0]===i[i.length-1]&&(i=JSON.parse(i)),i)return L$1(e)(o,i)}return!1};case"universal":return e=>!0;default:throw new Error(`Unhandled selector: ${e.type}`)}},d=e=>{let t="string"==typeof e?b(e):e;switch(null==t?void 0:t.type){case"list":{let e=t.list.map(e=>S$1(e));return(t,r,n)=>{for(let n of e)if(n(t,r))return!0;return!1}}case"compound":{let e=t.list.map(e=>S$1(e));return(t,r,n)=>{for(let n of e)if(!n(t,r))return!1;return!0}}case"complex":{let{left:e,right:r,combinator:n}=t,i=d(e),a=d(r),o=new WeakSet;return(e,t,r=0)=>{if((i(e)||t&&o.has(t)&&" "===n)&&o.add(e),!a(e))return!1;switch(n){case" ":case">":return!!t&&o.has(t);case"~":if(!t)return!1;for(let e of t.children.slice(0,r))if(o.has(e))return!0;return!1;case"+":{if(!t)return!1;let e=t.children.slice(0,r).filter(e=>1===e.type);if(0===e.length)return!1;let n=e[e.length-1];if(!n)return!1;if(o.has(n))return!0}default:return!1}}}default:return S$1(t)}},Se=Math.abs,Ae=String.fromCharCode;function J(e){return e.trim()}function Y(e,t,r){return e.replace(t,r)}function Ne(e,t,r){return e.indexOf(t,r)}function L(e,t){return 0|e.charCodeAt(t)}function S(e,t,r){return e.slice(t,r)}function R(e){return e.length}function F(e,t){return t.push(e),e}var Be=1,Re=1,je=0,Ue=0,He=0,Qe="";function te(e,t,r,n,i,a,o,s){return{value:e,root:t,parent:r,type:n,props:i,children:a,line:Be,column:Re,length:o,return:"",siblings:s}}function Ce(){return He=Ue>0?L(Qe,--Ue):0,Re--,10===He&&(Re=1,Be--),He}function k(){return He=Ue<je?L(Qe,Ue++):0,Re++,10===He&&(Re=1,Be++),He}function A(){return L(Qe,Ue)}function Q(){return Ue}function re(e,t){return S(Qe,e,t)}function B(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function ne(e){return J(re(Ue-1,de(91===e?e+2:40===e?e+1:e)))}function _e(e){for(;(He=A())&&He<33;)k();return B(e)>2||B(He)>3?"":" "}function Me(e,t){for(;--t&&k()&&!(He<48||He>102||He>57&&He<65||He>70&&He<97););return re(e,Q()+(t<6&&32==A()&&32==k()))}function de(e){for(;k();)switch(He){case e:return Ue;case 34:case 39:34!==e&&39!==e&&de(He);break;case 40:41===e&&de(e);break;case 92:k()}return Ue}function Le(e,t){for(;k()&&e+He!==57&&(e+He!==84||47!==A()););return"/*"+re(t,Ue-1)+"*"+Ae(47===e?e:k())}function Ve(e){for(;!B(A());)k();return re(e,Ue)}function fe(e){return function(e){return Qe="",e}(oe("",null,null,null,[""],e=function(e){return Be=Re=1,je=R(Qe=e),Ue=0,[]}(e),0,[0],e))}function oe(e,t,r,n,i,a,o,s,u){for(var f=0,c=0,m=o,v=0,T=0,P=0,E=1,N=1,$=1,j=0,G="",D=i,U=a,q=n,Z=G;N;)switch(P=j,j=k()){case 40:if(108!=P&&58==L(Z,m-1)){-1!=Ne(Z+=Y(ne(j),"&","&\f"),"&\f",Se(f?s[f-1]:0))&&($=-1);break}case 34:case 39:case 91:Z+=ne(j);break;case 9:case 10:case 13:case 32:Z+=_e(P);break;case 92:Z+=Me(Q()-1,7);continue;case 47:switch(A()){case 42:case 47:F(vt(Le(k(),Q()),t,r,u),u),(5==B(P||1)||5==B(A()||1))&&R(Z)&&" "!==S(Z,-1,void 0)&&(Z+=" ");break;default:Z+="/"}break;case 123*E:s[f++]=R(Z)*$;case 125*E:case 59:case 0:switch(j){case 0:case 125:N=0;case 59+c:-1==$&&(Z=Y(Z,/\f/g,"")),T>0&&(R(Z)-m||0===E&&47===P)&&F(T>32?De(Z+";",n,r,m-1,u):De(Y(Z," ","")+";",n,r,m-2,u),u);break;case 59:Z+=";";default:if(F(q=Fe(Z,t,r,f,c,i,s,G,D=[],U=[],m,a),a),123===j)if(0===c)oe(Z,t,q,q,D,a,m,s,U);else switch(99===v&&110===L(Z,3)?100:v){case 100:case 108:case 109:case 115:oe(e,q,q,n&&F(Fe(e,q,q,0,0,i,s,G,i,D=[],m,U),U),i,U,m,s,n?D:U);break;default:oe(Z,q,q,q,[""],U,0,s,U)}}f=c=T=0,E=$=1,G=Z="",m=o;break;case 58:m=1+R(Z),T=P;default:if(E<1)if(123==j)--E;else if(125==j&&0==E++&&125==Ce())continue;switch(Z+=Ae(j),j*E){case 38:$=c>0?1:(Z+="\f",-1);break;case 44:s[f++]=(R(Z)-1)*$,$=1;break;case 64:45===A()&&(Z+=ne(k())),v=A(),c=m=R(G=Z+=Ve(Q())),j++;break;case 45:45===P&&2==R(Z)&&(E=0)}}return a}function Fe(e,t,r,n,i,a,o,s,u,f,c,m){for(var v=i-1,T=0===i?a:[""],P=function(e){return e.length}(T),E=0,N=0,$=0;E<n;++E)for(var j=0,G=S(e,v+1,v=Se(N=o[E])),D=e;j<P;++j)(D=J(N>0?T[j]+" "+G:Y(G,/&\f/g,T[j])))&&(u[$++]=D);return te(e,t,r,0===i?"rule":s,u,f,c,m)}function vt(e,t,r,n){return te(e,t,r,"comm",Ae(He),S(e,2,-2),0,n)}function De(e,t,r,n,i){return te(e,t,r,"decl",S(e,0,n),S(e,n+1,-1),n,i)}var Ke,C=e=>"object"==typeof e&&null!==e&&"errid"in e,Ge=e=>{var t,r,n;let i=e.at(0);if(i){if("("===i.type){let r=_(e,!0);if(C(r)){let{start:n,end:a}=null!==(t=e.at(1))&&void 0!==t?t:i;return{errid:"EXPECT_FEATURE_OR_CONDITION",start:n,end:a,child:r}}return{type:"query",mediaCondition:r}}if("ident"===i.type){let t,a,{value:o,end:s}=i;"only"!==o&&"not"!==o||(t=o);let u=void 0===t?0:1,f=e.at(u);if(!f)return{errid:"EXPECT_LPAREN_OR_TYPE",start:s,end:s};if("ident"!==f.type){if("not"===t&&"("===f.type){let t=_(e.slice(u),!0);if(C(t)){let{start:n,end:i}=null!==(r=e.at(u+1))&&void 0!==r?r:f;return{errid:"EXPECT_CONDITION",start:n,end:i,child:t}}return{type:"query",mediaCondition:{type:"condition",operator:"not",children:[t]}}}{let{start:e,end:t}=f;return{errid:"EXPECT_TYPE",start:e,end:t}}}{let{value:e,start:r,end:n}=f;if("all"===e)a=void 0;else if("print"===e||"screen"===e)a=e;else{if("tty"!==e&&"tv"!==e&&"projection"!==e&&"handheld"!==e&&"braille"!==e&&"embossed"!==e&&"aural"!==e&&"speech"!==e)return{errid:"EXPECT_TYPE",start:r,end:n};t="not"===t?void 0:"not",a=void 0}}if(u+1===e.length)return{type:"query",prefix:t,mediaType:a};{let r=e[u+1];if("ident"===r.type&&"and"===r.value){let r,i=e.at(-1),o=e.at(u+2),s=i.end+1;if("ident"===(null==o?void 0:o.type)&&"not"===o.value){s+=1;let t=_(e.slice(u+3),!1);r=C(t)?t:{type:"condition",operator:"not",children:[t]}}else r=_(e.slice(u+2),!1);let{start:f,end:c}=null!==(n=e.at(u+2))&&void 0!==n?n:{start:s,end:s};return C(r)?{errid:"EXPECT_CONDITION",start:f,end:c,child:r}:{type:"query",prefix:t,mediaType:a,mediaCondition:r}}return{errid:"EXPECT_AND",start:r.start,end:r.end}}}return{errid:"EXPECT_LPAREN_OR_TYPE_OR_MODIFIER",start:i.start,end:i.end}}return{errid:"EMPTY_QUERY",start:0,end:0}},_=(e,t,r)=>{let n=e.at(0);if(n){if("("!==n.type)return{errid:"EXPECT_LPAREN",start:n.start,end:n.end};let i,a=e.length-1,o=0,s=0;for(let[t,r]of e.entries())if("("===r.type?(s+=1,o=Math.max(o,s)):")"===r.type&&(s-=1),0===s){a=t;break}if(0!==s)return{errid:"MISMATCH_PARENS",start:n.start,end:e[e.length-1].end};let u=e.slice(0,a+1);if(i=1===o?qe(u):"ident"===u[1].type&&"not"===u[1].value?_(u.slice(2,-1),!0,"not"):_(u.slice(1,-1),!0),C(i))return{errid:"EXPECT_FEATURE_OR_CONDITION",start:n.start,end:u[u.length-1].end,child:i};if(a===e.length-1)return{type:"condition",operator:r,children:[i]};{let n=e[a+1];if("ident"!==n.type||"and"!==n.value&&"or"!==n.value)return{errid:"EXPECT_AND_OR_OR",start:n.start,end:n.end};if(void 0!==r&&r!==n.value)return{errid:"MIX_AND_WITH_OR",start:n.start,end:n.end};if("or"===n.value&&!t)return{errid:"MIX_AND_WITH_OR",start:n.start,end:n.end};let o=_(e.slice(a+2),t,n.value);return C(o)?o:{type:"condition",operator:n.value,children:[i,...o.children]}}}return{errid:"EMPTY_CONDITION",start:0,end:0}},qe=e=>{let t=e.at(0);if(t){if("("!==t.type)return{errid:"EXPECT_LPAREN",start:t.start,end:t.end};let r=e[e.length-1];if(")"!==r.type)return{errid:"EXPECT_RPAREN",start:r.end+1,end:r.end+1};let n=[e[0]];for(let t=1;t<e.length;t++){if(t<e.length-2){let r=e[t],i=e[t+1],a=e[t+2];if("number"===r.type&&r.value>0&&"delim"===i.type&&47===i.value&&"number"===a.type&&a.value>0){n.push({type:"ratio",numerator:r.value,denominator:a.value,hasSpaceBefore:r.hasSpaceBefore,hasSpaceAfter:a.hasSpaceAfter,start:r.start,end:a.end}),t+=2;continue}}n.push(e[t])}let i=n[1];if("ident"===i.type&&3===n.length)return{type:"feature",context:"boolean",feature:i.value};if(5===n.length&&"ident"===n[1].type&&"colon"===n[2].type){let e=n[3];if("number"===e.type||"dimension"===e.type||"ratio"===e.type||"ident"===e.type){let t,r=n[1].value,i=r.slice(0,4);"min-"===i?(t="min",r=r.slice(4)):"max-"===i&&(t="max",r=r.slice(4));let{hasSpaceBefore:a,hasSpaceAfter:o,start:s,end:u,...f}=e;return{type:"feature",context:"value",prefix:t,feature:r,value:f}}return{errid:"EXPECT_VALUE",start:e.start,end:e.end}}if(n.length>=5){let e=gt(n);if(C(e))return{errid:"EXPECT_RANGE",start:t.start,end:n[n.length-1].end,child:e};{let{feature:t,...r}=e;return{type:"feature",context:"range",feature:t,range:r}}}return{errid:"INVALID_FEATURE",start:t.start,end:e[e.length-1].end}}return{errid:"EMPTY_FEATURE",start:0,end:0}},gt=e=>{var t,r,n,i,a,o,s,u;if(e.length<5)return{errid:"INVALID_RANGE",start:null!==(r=null===(t=e.at(0))||void 0===t?void 0:t.start)&&void 0!==r?r:0,end:null!==(i=null===(n=e.at(-1))||void 0===n?void 0:n.end)&&void 0!==i?i:0};if("("!==e[0].type)return{errid:"EXPECT_LPAREN",start:e[0].start,end:e[0].end};let f=e[e.length-1];if(")"!==f.type)return{errid:"EXPECT_RPAREN",start:f.start,end:f.end};let c={feature:""},m="number"===e[1].type||"dimension"===e[1].type||"ratio"===e[1].type||"ident"===e[1].type&&"infinite"===e[1].value;if("delim"===e[2].type){if(60===e[2].value)"delim"!==e[3].type||61!==e[3].value||e[3].hasSpaceBefore?c[m?"leftOp":"rightOp"]="<":c[m?"leftOp":"rightOp"]="<=";else if(62===e[2].value)"delim"!==e[3].type||61!==e[3].value||e[3].hasSpaceBefore?c[m?"leftOp":"rightOp"]=">":c[m?"leftOp":"rightOp"]=">=";else{if(61!==e[2].value)return{errid:"INVALID_RANGE",start:e[0].start,end:f.end};c[m?"leftOp":"rightOp"]="="}if(m)c.leftToken=e[1];else{if("ident"!==e[1].type)return{errid:"INVALID_RANGE",start:e[0].start,end:f.end};c.feature=e[1].value}let t=2+(null!==(o=null===(a=c[m?"leftOp":"rightOp"])||void 0===a?void 0:a.length)&&void 0!==o?o:0),r=e[t];if(m){if("ident"!==r.type)return{errid:"INVALID_RANGE",start:e[0].start,end:f.end};if(c.feature=r.value,e.length>=7){let r=e[t+1],n=e[t+2];if("delim"!==r.type)return{errid:"INVALID_RANGE",start:e[0].start,end:f.end};{let i=r.value;if(60===i)"delim"!==n.type||61!==n.value||n.hasSpaceBefore?c.rightOp="<":c.rightOp="<=";else{if(62!==i)return{errid:"INVALID_RANGE",start:e[0].start,end:f.end};"delim"!==n.type||61!==n.value||n.hasSpaceBefore?c.rightOp=">":c.rightOp=">="}let a=t+1+(null!==(u=null===(s=c.rightOp)||void 0===s?void 0:s.length)&&void 0!==u?u:0),o=e.at(a);if(a+2!==e.length)return{errid:"INVALID_RANGE",start:e[0].start,end:f.end};c.rightToken=o}}else if(t+2!==e.length)return{errid:"INVALID_RANGE",start:e[0].start,end:f.end}}else c.rightToken=r;let n,i,v,{leftToken:T,leftOp:P,feature:E,rightOp:N,rightToken:$}=c;if(void 0!==T)if("ident"===T.type){let{type:e,value:t}=T;"infinite"===t&&(i={type:e,value:t})}else if("number"===T.type||"dimension"===T.type||"ratio"===T.type){let{hasSpaceBefore:e,hasSpaceAfter:t,start:r,end:n,...a}=T;i=a}if(void 0!==$)if("ident"===$.type){let{type:e,value:t}=$;"infinite"===t&&(v={type:e,value:t})}else if("number"===$.type||"dimension"===$.type||"ratio"===$.type){let{hasSpaceBefore:e,hasSpaceAfter:t,start:r,end:n,...i}=$;v=i}if(void 0!==i&&void 0!==v)if("<"!==P&&"<="!==P||"<"!==N&&"<="!==N){if(">"!==P&&">="!==P||">"!==N&&">="!==N)return{errid:"INVALID_RANGE",start:e[0].start,end:f.end};n={leftToken:i,leftOp:P,feature:E,rightOp:N,rightToken:v}}else n={leftToken:i,leftOp:P,feature:E,rightOp:N,rightToken:v};else(void 0===i&&void 0===P&&void 0!==N&&void 0!==v||void 0!==i&&void 0!==P&&void 0===N&&void 0===v)&&(n={leftToken:i,leftOp:P,feature:E,rightOp:N,rightToken:v});return n??{errid:"INVALID_RANGE",start:e[0].start,end:f.end}}return{errid:"INVALID_RANGE",start:e[0].start,end:f.end}},Ye=e=>e.mediaCondition?{type:"query",prefix:e.prefix,mediaType:e.mediaType,mediaCondition:me(e.mediaCondition)}:e,me=e=>{let t=[];for(let r of e.children)if("condition"===r.type){let n=me(r);void 0===n.operator&&1===n.children.length?t.push(n.children[0]):n.operator!==e.operator||"and"!==n.operator&&"or"!==n.operator?t.push(n):t.push(...n.children)}else t.push(r);if(1===t.length){let r=t[0];if("condition"===r.type){if(void 0===e.operator)return r;if("not"===e.operator&&"not"===r.operator)return{type:"condition",children:r.children}}}return{type:"condition",operator:e.operator,children:t}},M=e=>{switch(e.type){case"query-list":for(let t of e.mediaQueries)M(t);return e;case"query":return void 0===e.prefix&&delete e.prefix,void 0===e.mediaType&&delete e.mediaType,void 0===e.mediaCondition?delete e.mediaCondition:M(e.mediaCondition),e;case"condition":void 0===e.operator&&delete e.operator;for(let t of e.children)M(t);return e;case"feature":return"value"===e.context?(void 0===e.prefix&&delete e.prefix,M(e.value)):"range"===e.context&&(void 0===e.range.leftOp&&delete e.range.leftOp,void 0===e.range.rightOp&&delete e.range.rightOp,void 0===e.range.leftToken?delete e.range.leftToken:M(e.range.leftToken),void 0===e.range.rightToken?delete e.range.rightToken:M(e.range.rightToken)),e;default:return e}},ze=(e,t)=>{if(e.length<=t+1)return null;let r=e.at(t),n=[];for(let i=t+1;i<e.length;i+=1){let t=e.at(i);if(t===r)return[i,String.fromCodePoint(...n)];if(92===t){let t=ve(e,i);if(null===t)return null;let[r,a]=t;n.push(a),i=r}else{if(10===t)return null;n.push(t)}}return null},We=(e,t)=>{let r=e.at(t);if(void 0===r)return!1;if(45===r){let r=e.at(t+1);return void 0!==r&&(45===r||95===r||r>=65&&r<=90||r>=97&&r<=122||r>=128||92===r&&(!(e.length<=t+2)&&10!==e.at(t+2)))}return 95===r||r>=65&&r<=90||r>=97&&r<=122||r>=128||92===r&&(!(e.length<=t+1)&&10!==e.at(t+1))},ve=(e,t)=>{if(e.length<=t+1||92!==e.at(t))return null;let r=e.at(t+1);if(10===r)return null;if(r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102){let n=[r],i=Math.min(t+7,e.length),a=t+2;for(;a<i;a+=1){let t=e.at(a);if(!(t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102))break;n.push(t)}if(a<e.length){let t=e.at(a);9!==t&&32!==t&&10!==t||(a+=1)}return[a-1,Number.parseInt(String.fromCodePoint(...n),16)]}return[t+1,r]},ie=(e,t)=>{let r=xt(e,t);if(null===r)return null;let[n,i,a]=r,o=ye(e,n+1);if(null!==o){let[e,t]=o;return[e,["dimension",i,t]]}return n+1<e.length&&37===e.at(n+1)?[n+1,["percentage",i]]:[n,["number",i,a]]},xt=(e,t)=>{let r=e.at(t);if(void 0===r)return null;let n="integer",i=[];for(43!==r&&45!==r||(t+=1,45===r&&i.push(45));t<e.length;){let r=e.at(t);if(!(r>=48&&r<=57))break;i.push(r),t+=1}if(t+1<e.length){let r=e.at(t),a=e.at(t+1);if(46===r&&a>=48&&a<=57)for(i.push(r,a),n="number",t+=2;t<e.length;){let r=e.at(t);if(!(r>=48&&r<=57))break;i.push(r),t+=1}}if(t+1<e.length){let r=e.at(t),a=e.at(t+1),o=e.at(t+2);if(69===r||101===r){let r=!1;if(a>=48&&a<=57?(i.push(69,a),t+=2,r=!0):(45===a||43===a)&&void 0!==o&&o>=48&&o<=57&&(i.push(69),45===a&&i.push(45),i.push(o),t+=3,r=!0),r)for(n="number";t<e.length;){let r=e.at(t);if(!(r>=48&&r<=57))break;i.push(r),t+=1}}}let a=String.fromCodePoint(...i),o="number"===n?Number.parseFloat(a):Number.parseInt(a);return 0===o&&(o=0),Number.isNaN(o)?null:[t-1,o,n]},$e=(e,t)=>{if(e.length<=t)return null;let r=[];for(let n=e.at(t);t<e.length;n=e.at(++t)){if(!(45===n||95===n||n>=65&&n<=90||n>=97&&n<=122||n>=128||n>=48&&n<=57)){{let n=ve(e,t);if(null!==n){let[e,i]=n;r.push(i),t=e;continue}}break}r.push(n)}return 0===t?null:[t-1,String.fromCodePoint(...r)]},ye=(e,t)=>We(e,t)?$e(e,t):null,bt=(e,t)=>{let r=e.at(t);for(;9===r||32===r||10===r;)r=e.at(++t);let n=[],i=!1;for(;t<e.length;){if(41===r)return[t,String.fromCodePoint(...n)];if(34===r||39===r||40===r)return null;if(9===r||32===r||10===r)!i&&n.length>0&&(i=!0);else if(92===r){let r=ve(e,t);if(null===r||i)return null;let[a,o]=r;n.push(o),t=a}else{if(i)return null;n.push(r)}r=e.at(++t)}return null},Xe=(e,t)=>{let r=ye(e,t);if(null===r)return null;let[n,i]=r;if("url"===i.toLowerCase()){if(e.length>n+1&&40===e.at(n+1)){for(let t=2;n+t<e.length;t+=1){let r=e.at(n+t);if(34===r||39===r)return[n+1,i.toLowerCase(),"function"];if(9!==r&&32!==r&&10!==r){let r=bt(e,n+t);if(null===r)return null;let[i,a]=r;return[i,a,"url"]}}return[n+1,i.toLowerCase(),"function"]}}else if(e.length>n+1&&40===e.at(n+1))return[n+1,i.toLowerCase(),"function"];return[n,i.toLowerCase(),"ident"]},Ze=e=>{let t=((e,t=0)=>{let r=[];for(;t<e.length;t+=1){let n=e.at(t),i=t;if(47===n&&42===e.at(t+1)){t+=2;for(let r=e.at(t);void 0!==r;r=e.at(++t))if(42===r&&47===e.at(t+1)){t+=1;break}}else if(9===n||32===n||10===n){let n=e.at(++t);for(;9===n||32===n||10===n;)n=e.at(++t);t-=1;let a=r.at(-1);"whitespace"===(null==a?void 0:a.type)?(r.pop(),r.push({type:"whitespace",start:a.start,end:t})):r.push({type:"whitespace",start:i,end:t})}else if(34===n){let n=ze(e,t);if(null===n)return{errid:"INVALID_STRING",start:t,end:t};let[a,o]=n;t=a,r.push({type:"string",value:o,start:i,end:t})}else if(35===n){if(t+1<e.length){let n=e.at(t+1);if(95===n||n>=65&&n<=90||n>=97&&n<=122||n>=128||n>=48&&n<=57||92===n&&t+2<e.length&&10!==e.at(t+2)){let n=We(e,t+1)?"id":"unrestricted",a=$e(e,t+1);if(null!==a){let[e,o]=a;t=e,r.push({type:"hash",value:o.toLowerCase(),flag:n,start:i,end:t});continue}}}r.push({type:"delim",value:n,start:i,end:t})}else if(39===n){let n=ze(e,t);if(null===n)return{errid:"INVALID_STRING",start:t,end:t};let[a,o]=n;t=a,r.push({type:"string",value:o,start:i,end:t})}else if(40===n)r.push({type:"(",start:i,end:t});else if(41===n)r.push({type:")",start:i,end:t});else if(43===n){let a=ie(e,t);if(null===a)r.push({type:"delim",value:n,start:i,end:t});else{let[e,n]=a;t=e,"dimension"===n[0]?r.push({type:"dimension",value:n[1],unit:n[2].toLowerCase(),flag:"number",start:i,end:t}):"number"===n[0]?r.push({type:n[0],value:n[1],flag:n[2],start:i,end:t}):r.push({type:n[0],value:n[1],flag:"number",start:i,end:t})}}else if(44===n)r.push({type:"comma",start:i,end:t});else if(45===n){let a=ie(e,t);if(null!==a){let[e,n]=a;t=e,"dimension"===n[0]?r.push({type:"dimension",value:n[1],unit:n[2].toLowerCase(),flag:"number",start:i,end:t}):"number"===n[0]?r.push({type:n[0],value:n[1],flag:n[2],start:i,end:t}):r.push({type:n[0],value:n[1],flag:"number",start:i,end:t});continue}if(t+2<e.length){let n=e.at(t+1),a=e.at(t+2);if(45===n&&62===a){t+=2,r.push({type:"CDC",start:i,end:t});continue}}let o=Xe(e,t);if(null!==o){let[e,n,a]=o;t=e,r.push({type:a,value:n,start:i,end:t});continue}r.push({type:"delim",value:n,start:i,end:t})}else if(46===n){let a=ie(e,t);if(null!==a){let[e,n]=a;t=e,"dimension"===n[0]?r.push({type:"dimension",value:n[1],unit:n[2].toLowerCase(),flag:"number",start:i,end:t}):"number"===n[0]?r.push({type:n[0],value:n[1],flag:n[2],start:i,end:t}):r.push({type:n[0],value:n[1],flag:"number",start:i,end:t});continue}r.push({type:"delim",value:n,start:i,end:t})}else if(58===n)r.push({type:"colon",start:i,end:t});else if(59===n)r.push({type:"semicolon",start:i,end:t});else if(60===n){if(t+3<e.length){let n=e.at(t+1),a=e.at(t+2),o=e.at(t+3);if(33===n&&45===a&&45===o){t+=3,r.push({type:"CDO",start:i,end:t});continue}}r.push({type:"delim",value:n,start:i,end:t})}else if(64===n){let a=ye(e,t+1);if(null!==a){let[e,n]=a;t=e,r.push({type:"at-keyword",value:n.toLowerCase(),start:i,end:t});continue}r.push({type:"delim",value:n,start:i,end:t})}else if(91===n)r.push({type:"[",start:i,end:t});else if(93===n)r.push({type:"]",start:i,end:t});else if(123===n)r.push({type:"{",start:i,end:t});else if(125===n)r.push({type:"}",start:i,end:t});else if(n>=48&&n<=57){let n=ie(e,t),[a,o]=n;t=a,"dimension"===o[0]?r.push({type:"dimension",value:o[1],unit:o[2].toLowerCase(),flag:"number",start:i,end:t}):"number"===o[0]?r.push({type:o[0],value:o[1],flag:o[2],start:i,end:t}):r.push({type:o[0],value:o[1],flag:"number",start:i,end:t})}else if(95===n||n>=65&&n<=90||n>=97&&n<=122||n>=128||92===n){let a=Xe(e,t);if(null===a)r.push({type:"delim",value:n,start:i,end:t});else{let[e,n,o]=a;t=e,r.push({type:o,value:n,start:i,end:t})}}else r.push({type:"delim",value:n,start:i,end:t})}return r.push({type:"EOF",start:t,end:t}),r})((e=>{let t=(()=>{let e;return Ke?e=Ke:(e=new TextEncoder,Ke=e),e})().encode(e),r=[],n=t.length;for(let e=0;e<n;e+=1){let n=t.at(e);if(n<128)switch(n){case 0:r.push(65533);break;case 12:r.push(10);break;case 13:r.push(10),10===t.at(e+1)&&(e+=1);break;default:r.push(n)}else n<224?r.push(n<<59>>>53|t[++e]<<58>>>58):n<240?r.push(n<<60>>>48|t[++e]<<58>>>52|t[++e]<<58>>>58):r.push(n<<61>>>43|t[++e]<<58>>>46|t[++e]<<58>>>52|t[++e]<<58>>>58)}return r})(e));return C(t)?t:(e=>{let t=[],r=!1;for(let n of e)switch(n.type){case"{":return{errid:"NO_LCURLY",start:n.start,end:n.end};case"semicolon":return{errid:"NO_SEMICOLON",start:n.start,end:n.end};case"whitespace":r=!0,t.length>0&&(t[t.length-1].hasSpaceAfter=!0);break;case"EOF":break;default:t.push({...n,hasSpaceBefore:r,hasSpaceAfter:!1}),r=!1}return t})(t)},ae=e=>"object"==typeof e&&null!==e&&"errid"in e,Je=e=>{let t=Ze(e);return ae(t)?(e=>{let t=[e];for(let r=e.child;void 0!==r;r=r.child)t.push(r);for(let e=t.length-2;e>=0;e--)t[e+1].child=t.at(e);return delete t[0].child,t.at(-1)})(t):M((e=>({type:"query-list",mediaQueries:e.mediaQueries.map(e=>Ye(e))}))((e=>{let t=(e=>{let t=[[]],r=[];for(let n of e)if("comma"===n.type&&0===r.length)t.push([]);else{switch(n.type){case"function":case"(":r.push(")");break;case"[":r.push("]");break;case"{":r.push("}");break;case")":case"]":case"}":r.at(-1)===n.type&&r.pop()}t[t.length-1].push(n)}return t})(e);if(1===t.length&&0===t[0].length)return{type:"query-list",mediaQueries:[{type:"query"}]};{let e=[];for(let r of t){let t=Ge(r);C(t)?e.push({type:"query",prefix:"not"}):e.push(t)}return{type:"query-list",mediaQueries:e}}})(t)))},et={"any-hover":{none:1,hover:1},"any-pointer":{none:1,coarse:1,fine:1},"color-gamut":{srgb:1,p3:1,rec2020:1},grid:{0:1,1:1},hover:{none:1,hover:1},"overflow-block":{none:1,scroll:1,paged:1},"overflow-inline":{none:1,scroll:1},pointer:{none:1,coarse:1,fine:1},scan:{interlace:1,progressive:1},update:{none:1,slow:1,fast:1},"display-mode":{fullscreen:1,standalone:1,"minimal-ui":1,browser:1},"dynamic-range":{standard:1,high:1},"environment-blending":{opaque:1,additive:1,subtractive:1},"forced-colors":{none:1,active:1},"inverted-colors":{none:1,inverted:1},"nav-controls":{none:1,back:1},"prefers-color-scheme":{light:1,dark:1},"prefers-contrast":{"no-preference":1,less:1,more:1,custom:1},"prefers-reduced-data":{"no-preference":1,reduce:1},"prefers-reduced-motion":{"no-preference":1,reduce:1},"prefers-reduced-transparency":{"no-preference":1,reduce:1},scripting:{none:1,"initial-only":1,enabled:1},"video-color-gamut":{srgb:1,p3:1,rec2020:1},"video-dynamic-range":{standard:1,high:1}},rt={color:{feature:"color",type:"integer",bounds:[!0,0,1/0,!1]},"color-index":{feature:"color-index",type:"integer",bounds:[!0,0,1/0,!1]},monochrome:{feature:"monochrome",type:"integer",bounds:[!0,0,1/0,!1]},"device-height":{feature:"device-height",type:"length",bounds:[!0,0,1/0,!1]},"device-width":{feature:"device-width",type:"length",bounds:[!0,0,1/0,!1]},height:{feature:"height",type:"length",bounds:[!0,0,1/0,!1]},width:{feature:"width",type:"length",bounds:[!0,0,1/0,!1]},resolution:{feature:"resolution",type:"resolution",bounds:[!0,0,1/0,!1]},"horizontal-viewport-segments":{feature:"horizontal-viewport-segments",type:"integer",bounds:[!0,0,1/0,!1]},"vertical-viewport-segments":{feature:"vertical-viewport-segments",type:"integer",bounds:[!0,0,1/0,!1]}},nt={"aspect-ratio":{feature:"aspect-ratio",type:"ratio",bounds:[!1,[0,1],[1/0,1],!1]},"device-aspect-ratio":{feature:"device-aspect-ratio",type:"ratio",bounds:[!1,[0,1],[1/0,1],!1]}},K=e=>Object.entries(e).filter(e=>void 0!==e[1]),lt=new Set(Object.keys(et)),tt=e=>lt.has(e[0]),ue=e=>lt.has(e),ut=new Set(Object.keys(nt)),z=e=>ut.has(e[0]),X=e=>ut.has(e),ft=new Set(Object.keys(rt)),xe=e=>ft.has(e[0]),ot=e=>ft.has(e),it=e=>xe(e)||z(e),be=e=>ot(e)||X(e),Ee=e=>ot(e)||X(e)||ue(e),V=(e,t)=>{e[t[0]]=t[1]},se=(...e)=>e.reduce((e,t)=>"{true}"===e?t:"{true}"===t?e:"{false}"===e||"{false}"===t?"{false}":((e,t)=>{let[r,n,i,a]=e,o="number"==typeof n?n:n[0]/n[1],s="number"==typeof i?i:i[0]/i[1],[u,f,c,m]=t,v="number"==typeof f?f:f[0]/f[1],T="number"==typeof c?c:c[0]/c[1],P=r!==u&&!r;o!==v&&(P=o>v);let E=a!==m&&!a;s!==T&&(E=s<T);let N=P?r:u,$=P?n:f,j=E?i:c,G=E?a:m;return $>j||$===j&&(!N||!G)?"{false}":[N,$,j,G]})(e,t),"{true}"),pe=e=>{if(z(e)){let{bounds:t}=nt[e[0]],r=se(e[1],t);if("string"==typeof r)return r;if(r[0]===t[0]&&r[1][0]===t[1][0]&&r[1][1]===t[1][1]&&r[2][0]===t[2][0]&&r[2][1]===t[2][1]&&r[3]===t[3])return"{true}";{let e=r[1][0]/r[1][1],t=r[2][0]/r[2][1];return e>t||e===t&&(!r[0]||!r[3])?"{false}":r}}{let{bounds:t}=rt[e[0]],r=se(e[1],t);return"string"==typeof r?r:r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]?"{true}":r[1]>r[2]||r[1]===r[2]&&(!r[0]||!r[3])?"{false}":r}},at=e=>{if("string"==typeof e[1])throw new Error("expected range");let{bounds:t}=nt[e[0]],[r,n,i,a]=e[1],o=n[0]/n[1],s=i[0]/i[1],u=t[1][0]/t[1][1],f=t[0],c=t[2][0]/t[2][1],m=t[3],v=s>c||s===c&&!(m&&!a);return o<u||o===u&&(!f||r)?v?"{false}":[[!a,i,t[2],t[3]]]:v?[[t[0],t[1],n,!r]]:[[t[0],t[1],n,!r],[!a,i,t[2],t[3]]]};function st(e){if("string"==typeof e[1])throw new Error("expected range");let{bounds:t}=rt[e[0]],[r,n,i,a]=e[1],o=t[1],s=t[0],u=t[2],f=t[3],c=i>u||i===u&&!(f&&!a);return n<o||n===o&&(!s||r)?c?"{false}":[[!a,i,t[2],t[3]]]:c?[[t[0],t[1],n,!r]]:[[t[0],t[1],n,!r],[!a,i,t[2],t[3]]]}var ht={widthPx:1920,heightPx:1080,writingMode:"horizontal-tb",emPx:16,lhPx:16,exPx:8,chPx:8,capPx:11,icPx:16},O=(e,t)=>{if("number"===e.type)return{type:"number",value:e.value};if("dimension"===e.type){let r;switch(e.unit){case"s":case"ms":r="time";break;case"hz":case"khz":r="frequency";break;case"dpi":case"dpcm":case"dppx":case"x":r="resolution";break;default:r="length"}if("px"===e.unit)return{type:"dimension",subtype:"length",px:e.value};if("time"===r)return{type:"dimension",subtype:"time",ms:"s"===e.unit?Math.round(1e3*e.value):e.value};if("frequency"===r)return{type:"dimension",subtype:"frequency",hz:"khz"===e.unit?Math.round(1e3*e.value):e.value};if("resolution"===r){let t=e.value;return"dpi"===e.unit?t=Number.parseFloat((.0104166667*e.value).toFixed(3)):"dpcm"===e.unit&&(t=Number.parseFloat((.0264583333*e.value).toFixed(3))),{type:"dimension",subtype:"resolution",dppx:t}}if(e.unit in t){let r=t[e.unit];return{type:"dimension",subtype:"length",px:Number.parseFloat((e.value*r).toFixed(3))}}return{type:"ident",value:"{never}"}}return"ident"===e.type?"infinite"===e.value?{type:"infinite"}:{type:"ident",value:e.value}:{type:"ratio",numerator:e.numerator,denominator:e.denominator}},yt={"<":">","<=":">=",">":"<",">=":"<="},H=e=>"number"===e.type&&e.value>0?[e.value,1]:"ratio"===e.type?[e.numerator,e.denominator]:null,W=(e,t)=>{let r=rt[t];if("infinite"===e.type){if("resolution"===t)return Number.POSITIVE_INFINITY}else if("integer"===r.type){if("number"===e.type&&Number.isInteger(e.value))return e.value}else if("resolution"===r.type){if("dimension"===e.type&&"resolution"===e.subtype)return e.dppx}else if("length"===r.type){if("dimension"===e.type&&"length"===e.subtype)return e.px;if("number"===e.type&&0===e.value)return 0}return null},pt=(e,t)=>{let r=[];for(let n of e)for(let e of t){let t=Pt(n,e);Object.keys(t).length>0&&r.push(t)}return r},Pt=(e,t)=>{let r={};for(let t of K(e))void 0!==t[1]&&V(r,t);for(let e of K(t))if(e[0]in r){if(void 0!==r[e[0]]){let t=r;if("media-type"!==e[0])if("invalid-features"===e[0])t[e[0]].push(...e[1]);else if("{false}"===t[e[0]]||"{false}"===e[1])t[e[0]]="{false}";else if("{true}"===t[e[0]])V(t,e);else if("{true}"!==e[1]){let t=r;xe(e)||z(e)?V(t,[e[0],se(t[e[0]],e[1])]):"color-gamut"===e[0]||"video-color-gamut"===e[0]?t[e[0]]=[t[e[0]][0]&&e[1][0],t[e[0]][1]&&e[1][1],t[e[0]][2]&&e[1][2],t[e[0]][3]&&e[1][3]]:V(t,[e[0],t[e[0]]===e[1]?t[e[0]]:"{false}"])}}}else V(r,e);return r},ct=e=>e.map(e=>dt(e)).reduce((e,t)=>pt(e,t)),dt=e=>{let t=K(e),r=[];for(let e of t)if(void 0!==e[1]){let t,n;if("invalid-features"===e[0])return[{[e[0]]:e[1]}];if("media-type"===e[0])continue;if(t=e,"{false}"===e[1])n=[[e[0],"{true}"]];else if("{true}"===e[1])n=[[e[0],"{false}"]];else if(tt(e))if("color-gamut"===e[0]){let t=e[1];n=[["color-gamut",[!t[0],!t[1],!t[2],!t[3]]]]}else n="grid"===e[0]?[["grid",0===e[1]?1:0]]:Object.keys(et[e[0]]).filter(t=>t!==e[1]).map(t=>[e[0],t]);else if(z(e)){let t=at(e);n=("{false}"===t?["{false}"]:t).map(t=>[e[0],t])}else{let t=st(e);n=("{false}"===t?["{false}"]:t).map(t=>[e[0],t])}r.push([t,n])}let n=[];for(let[,e]of r)for(let t of e)n.push({[t[0]]:t[1]});return n},It=(e,t)=>{let r=((e,t)=>{if("range"===e.context){if(be(e.feature)){let{range:r,feature:n}=e;return void 0!==r.leftToken&&void 0!==r.rightToken?"<"===r.leftOp||"<="===r.leftOp?{type:"double",name:n,minOp:r.leftOp,min:O(r.leftToken,t),maxOp:r.rightOp,max:O(r.rightToken,t)}:{type:"double",name:n,minOp:">"===r.rightOp?"<":"<=",min:O(r.rightToken,t),maxOp:r.leftOp?"<":"<=",max:O(r.leftToken,t)}:void 0===r.rightToken?"="===r.leftOp?{type:"equals",name:n,value:O(r.leftToken,t)}:{type:"single",name:n,op:yt[r.leftOp],value:O(r.leftToken,t)}:"="===r.rightOp?{type:"equals",name:n,value:O(r.rightToken,t)}:{type:"single",name:n,op:r.rightOp,value:O(r.rightToken,t)}}}else if("value"===e.context){if("orientation"===e.feature){if(void 0===e.prefix&&"ident"===e.value.type){if("portrait"===e.value.value)return{type:"single",name:"aspect-ratio",op:"<=",value:{type:"ratio",numerator:1,denominator:1}};if("landscape"===e.value.value)return{type:"single",name:"aspect-ratio",op:">=",value:{type:"ratio",numerator:1,denominator:1}}}}else if(Ee(e.feature)){if(void 0===e.prefix)return{type:"equals",name:e.feature,value:O(e.value,t)};if(be(e.feature))return"min"===e.prefix?{type:"single",name:e.feature,op:">=",value:O(e.value,t)}:{type:"single",name:e.feature,op:"<=",value:O(e.value,t)}}}else{if("orientation"===e.feature)return{type:"double",name:"aspect-ratio",min:{type:"ratio",numerator:0,denominator:1},minOp:"<",maxOp:"<",max:{type:"ratio",numerator:Number.POSITIVE_INFINITY,denominator:1}};if(Ee(e.feature))return{type:"boolean",name:e.feature}}return{type:"invalid",name:e.feature}})(e,t),n=[{"invalid-features":[e.feature]}];if("invalid"===r.type)return n;if("boolean"===r.type)return"color-gamut"===r.name?[{"color-gamut":[!1,!0,!0,!0]}]:"grid"===r.name?[{grid:1}]:ue(r.name)?dt({[r.name]:"none"}):X(r.name)?[{[r.name]:[!1,[0,1],[Number.POSITIVE_INFINITY,1],!0]}]:[{[r.name]:[!1,0,Number.POSITIVE_INFINITY,!0]}];if(ue(r.name)){if("equals"===r.type){let e=r.value;if("grid"===r.name){if("number"===e.type&&(0===e.value||1===e.value))return[{grid:e.value}]}else if("ident"===e.type&&e.value in et[r.name]){if("color-gamut"!==r.name)return[{[r.name]:e.value}];{let t=["srgb","p3","rec2020"].indexOf(e.value);if(-1!==t)return[{"color-gamut":[!1,t<=0,t<=1,t<=2]}]}}}return n}if(X(r.name)){let e=null;if("equals"===r.type){let t=H(r.value);null!==t&&(e=[!0,t,t,!0])}else if("single"===r.type){let t=H(r.value);null!==t&&(e="<"===r.op?[!0,[Number.NEGATIVE_INFINITY,1],t,!1]:"<="===r.op?[!0,[Number.NEGATIVE_INFINITY,1],t,!0]:">"===r.op?[!1,t,[Number.POSITIVE_INFINITY,1],!0]:[!0,t,[Number.POSITIVE_INFINITY,1],!0])}else if("double"===r.type){let t=H(r.min),n=H(r.max);null!==t&&null!==n&&(e=["<="===r.minOp,t,n,"<="===r.maxOp])}return null===e?n:[{[r.name]:pe([r.name,e])}]}{let e=null;if("equals"===r.type){let t=W(r.value,r.name);null!==t&&(e=[!0,t,t,!0])}else if("single"===r.type){let t=W(r.value,r.name);null!==t&&(e="<"===r.op?[!0,Number.NEGATIVE_INFINITY,t,!1]:"<="===r.op?[!0,Number.NEGATIVE_INFINITY,t,!0]:">"===r.op?[!1,t,Number.POSITIVE_INFINITY,!0]:[!0,t,Number.POSITIVE_INFINITY,!0])}else if("double"===r.type){let t=W(r.min,r.name),n=W(r.max,r.name);null!==t&&null!==n&&(e=["<="===r.minOp,t,n,"<="===r.maxOp])}return null===e?n:[{[r.name]:pe([r.name,e])}]}},Te=(e,t)=>{let r=[];for(let n of e.children)"context"in n?r.push(It(n,t)):r.push(Te(n,t));return"or"===e.operator||void 0===e.operator?r.flat():"and"===e.operator?r.reduce((e,t)=>pt(e,t)):ct(r[0])},Nt=(e,t={})=>{let r=(e=>{let t={};"number"==typeof e.emPx&&(t={exPx:Math.round(.5*e.emPx),chPx:Math.round(.5*e.emPx),capPx:Math.round(.7*e.emPx),icPx:Math.round(e.emPx)});let r={...ht,...t,...e},{widthPx:n,heightPx:i,writingMode:a,emPx:o,lhPx:s,exPx:u,chPx:f,capPx:c,icPx:m}=r,v=n/100,T=i/100;return{em:o,rem:o,lh:s,rlh:s,ex:u,ch:f,cap:c,ic:m,vw:v,vh:T,vmin:Math.min(T,v),vmax:Math.max(T,v),vi:"horizontal-tb"===a?v:T,vb:"horizontal-tb"===a?T:v,cm:37.79527559,mm:.03779527559,in:96,q:.009448818898,pc:16,pt:16}})(t),n=[];for(let t of e.mediaQueries){let e=[];"not"===t.prefix?("print"===t.mediaType?e.push({"media-type":"not-print"}):"screen"===t.mediaType&&e.push({"media-type":"not-screen"}),void 0!==t.mediaCondition&&e.push(...ct(Te(t.mediaCondition,r)))):void 0===t.mediaCondition?e.push({"media-type":t.mediaType}):e.push(...Te(t.mediaCondition,r).map(e=>({...e,"media-type":t.mediaType}))),n.push(...e)}return(e=>{let t=[],r=new Set,n=new Set;for(let i of e){let e=!1;if(Array.isArray(i["invalid-features"])&&i["invalid-features"].length>0){for(let e of i["invalid-features"])r.add(e);e=!0}let a={};for(let t of K(i))if("invalid-features"!==t[0]){if("color-gamut"===t[0]){let e=t[1].toString();"false,false,false,false"===e?t[1]="{false}":"true,true,true,true"===e&&(t[1]="{true}")}else it(t)&&(t[1]=pe(t));"{false}"===t[1]?(n.add(t[0]),e=!0):"{true}"===t[1]||"media-type"===t[0]&&"all"===t[1]||V(a,t)}e||t.push(a)}return{simplePerms:t,invalidFeatures:[...r].sort(),falseFeatures:[...n].sort()}})(n)},wt={mediaType:"screen",anyHover:"hover",anyPointer:"fine",colorGamut:"srgb-but-not-p3",grid:"bitmap",hover:"hover",overflowBlock:"scroll",overflowInline:"scroll",pointer:"fine",scan:"progressive",update:"fast",colorIndex:"none",colorBits:8,monochromeBits:"not-monochrome",displayMode:"browser",dynamicRange:"not-hdr",environmentBlending:"opaque",forcedColors:"none",invertedColors:"none",navControls:"back",prefersColorScheme:"no-preference",prefersContrast:"no-preference",prefersReducedData:"no-preference",prefersReducedMotion:"no-preference",prefersReducedTransparency:"no-preference",scripting:"enabled",videoColorGamut:"srgb-but-not-p3",videoDynamicRange:"not-hdr",horizontalViewportSegments:1,verticalViewportSegments:1},w=e=>new Error(`Invalid option: ${e}`),mt=(e,t)=>{let r={...wt,...t};(e=>{if("screen"!==e.mediaType&&"print"!==e.mediaType&&"not-screen-or-print"!==e.mediaType)throw w("mediaType");if("none"!==e.anyHover&&"hover"!==e.anyHover)throw w("anyHover");if("none"!==e.anyPointer&&"coarse"!==e.anyPointer&&"fine"!==e.anyPointer)throw w("anyPointer");if("not-srgb"!==e.colorGamut&&"srgb-but-not-p3"!==e.colorGamut&&"p3-but-not-rec2020"!==e.colorGamut&&"rec2020"!==e.colorGamut)throw w("colorGamut");if("bitmap"!==e.grid&&"grid"!==e.grid)throw w("grid");if("none"!==e.hover&&"hover"!==e.hover)throw w("hover");if("none"!==e.overflowBlock&&"scroll"!==e.overflowBlock&&"paged"!==e.overflowBlock)throw w("overflowBlock");if("none"!==e.overflowInline&&"scroll"!==e.overflowInline)throw w("overflowInline");if("none"!==e.pointer&&"coarse"!==e.pointer&&"fine"!==e.pointer)throw w("pointer");if("interlace"!==e.scan&&"progressive"!==e.scan)throw w("scan");if("none"!==e.update&&"slow"!==e.update&&"fast"!==e.update)throw w("update");if(!(Number.isInteger(e.widthPx)&&e.widthPx>=0))throw w("widthPx");if(!(Number.isInteger(e.heightPx)&&e.heightPx>=0))throw w("heightPx");if(!(Number.isInteger(e.deviceWidthPx)&&e.deviceWidthPx>=0))throw w("deviceWidthPx");if(!(Number.isInteger(e.deviceHeightPx)&&e.deviceHeightPx>=0))throw w("deviceHeightPx");if(!(Number.isInteger(e.colorBits)&&e.colorBits>=0))throw w("colorBits");if(e.dppx<=0)throw w("dppx");if("not-monochrome"!==e.monochromeBits&&!(Number.isInteger(e.monochromeBits)&&e.monochromeBits>=0))throw w("monochromeBits");if("none"!==e.colorIndex&&!(Number.isInteger(e.colorIndex)&&e.colorIndex>=0))throw w("colorIndex")})(r);for(let t of e.simplePerms){let e=!0;for(let n in t){let i=n,a=t;if("media-type"===i){let t=a[i];if("print"===t){if("screen"===r.mediaType||"not-screen-or-print"===r.mediaType){e=!1;break}}else if("screen"===t){if("print"===r.mediaType||"not-screen-or-print"===r.mediaType){e=!1;break}}else if("not-screen"===t){if("screen"===r.mediaType){e=!1;break}}else if("print"===r.mediaType){e=!1;break}}else if("any-hover"===i){if(a[i]!==r.anyHover){e=!1;break}}else if("hover"===i){if(a[i]!==r.hover){e=!1;break}}else if("any-pointer"===i){if(a[i]!==r.anyPointer){e=!1;break}}else if("pointer"===i){if(a[i]!==r.pointer){e=!1;break}}else if("grid"===i){let t=a[i];if(0===t&&"grid"===r.grid||1===t&&"bitmap"===r.grid){e=!1;break}}else if("color-gamut"===i){let[t,n,o,s]=a[i];if("not-srgb"===r.colorGamut&&!t||"srgb-but-not-p3"===r.colorGamut&&!n||"p3-but-not-rec2020"===r.colorGamut&&!o||"rec2020"===r.colorGamut&&!s){e=!1;break}}else if("video-color-gamut"===i){let[t,n,o,s]=a[i];if("not-srgb"===r.videoColorGamut&&!t||"srgb-but-not-p3"===r.videoColorGamut&&!n||"p3-but-not-rec2020"===r.videoColorGamut&&!o||"rec2020"===r.videoColorGamut&&!s){e=!1;break}}else if("overflow-block"===i){if(a[i]!==r.overflowBlock){e=!1;break}}else if("overflow-inline"===i){if(a[i]!==r.overflowInline){e=!1;break}}else if("scan"===i){if(a[i]!==r.scan){e=!1;break}}else if("update"===i){if(a[i]!==r.update){e=!1;break}}else if("scripting"===i){if(a[i]!==r.scripting){e=!1;break}}else if("display-mode"===i){if(a[i]!==r.displayMode){e=!1;break}}else if("environment-blending"===i){if(a[i]!==r.environmentBlending){e=!1;break}}else if("forced-colors"===i){if(a[i]!==r.forcedColors){e=!1;break}}else if("inverted-colors"===i){if(a[i]!==r.invertedColors){e=!1;break}}else if("nav-controls"===i){if(a[i]!==r.navControls){e=!1;break}}else if("prefers-color-scheme"===i){if(a[i]!==r.prefersColorScheme){e=!1;break}}else if("prefers-contrast"===i){if(a[i]!==r.prefersContrast){e=!1;break}}else if("prefers-reduced-data"===i){if(a[i]!==r.prefersReducedData){e=!1;break}}else if("prefers-reduced-motion"===i){if(a[i]!==r.prefersReducedMotion){e=!1;break}}else if("prefers-reduced-transparency"===i){if(a[i]!==r.prefersReducedTransparency){e=!1;break}}else if("dynamic-range"===i){if("high"===a[i]&&"not-hdr"===r.dynamicRange){e=!1;break}}else if("video-dynamic-range"===i){if("high"===a[i]&&"not-hdr"===r.videoDynamicRange){e=!1;break}}else if("vertical-viewport-segments"===i){let[t,n,o,s]=a[i];if(r.verticalViewportSegments<n||r.verticalViewportSegments>o||n===r.verticalViewportSegments&&!t||o===r.verticalViewportSegments&&!s){e=!1;break}}else if("horizontal-viewport-segments"===i){let[t,n,o,s]=a[i];if(r.horizontalViewportSegments<n||r.horizontalViewportSegments>o||n===r.horizontalViewportSegments&&!t||o===r.horizontalViewportSegments&&!s){e=!1;break}}else if("width"===i){let[t,n,o,s]=a[i];if(r.widthPx<n||r.widthPx>o||n===r.widthPx&&!t||o===r.widthPx&&!s){e=!1;break}}else if("device-width"===i){let[t,n,o,s]=a[i];if(r.deviceWidthPx<n||r.deviceWidthPx>o||n===r.deviceWidthPx&&!t||o===r.deviceWidthPx&&!s){e=!1;break}}else if("height"===i){let[t,n,o,s]=a[i];if(r.heightPx<n||r.heightPx>o||n===r.heightPx&&!t||o===r.heightPx&&!s){e=!1;break}}else if("device-height"===i){let[t,n,o,s]=a[i];if(r.deviceHeightPx<n||r.deviceHeightPx>o||n===r.deviceHeightPx&&!t||o===r.deviceHeightPx&&!s){e=!1;break}}else if("color"===i){let[t,n,o,s]=a[i];if(r.colorBits<n||r.colorBits>o||n===r.colorBits&&!t||o===r.colorBits&&!s){e=!1;break}}else if("monochrome"===i){let[t,n,o,s]=a[i];if("not-monochrome"===r.monochromeBits)(n>0||0===n&&!t||0===o&&!s)&&(e=!1);else if(r.monochromeBits<n||r.monochromeBits>o||n===r.monochromeBits&&!t||o===r.monochromeBits&&!s){e=!1;break}}else if("resolution"===i){let[t,n,o,s]=a[i];if(r.dppx<n||r.dppx>o||n===r.dppx&&!t||o===r.dppx&&!s){e=!1;break}}else if("color-index"===i){let[t,n,o,s]=a[i];if("none"===r.colorIndex){if(n>0||0===n&&!t||0===o&&!s){e=!1;break}}else if(r.colorIndex<n||r.colorIndex>o||n===r.colorIndex&&!t||o===r.colorIndex&&!s){e=!1;break}}else if("aspect-ratio"===i){let[t,n,o,s]=a[i],u=n[0]/n[1],f=o[0]/o[1],c=r.widthPx/r.heightPx;if(c<u||c>f||u===c&&!t||f===c&&!s){e=!1;break}}else{let[t,n,o,s]=a[i],u=n[0]/n[1],f=o[0]/o[1],c=r.deviceWidthPx/r.deviceHeightPx;if(c<u||c>f||u===c&&!t||f===c&&!s){e=!1;break}}}if(e)return!0}return!1};const kt=new Set([/[mp](t|b|r|l|x|y)?-/,"color-","flex","h-","w-","min-w-","min-h-","max-w-","max-h-","leading-","text-","opacity-","font-","aspect-","tint-","bg-","opacity-","shadow-","rounded","top-","right-","bottom-","left-","inset-","border","elevation-","tracking-","z-"]),Tt=function(e){let{useObjectSyntax:t=!1}=e??{};return r=>{let n=t?[":where([style]) {}"]:[],i=[];B$1(r,(e,t)=>{1===e.type&&"style"===e.name&&(n.push(e.children.map(e=>2===e.type?e.value:"").join("")),i.push(()=>{t.children=t.children.filter(t=>t!==e)}))});for(let e of i)e();let a=fe(n.join("\n")),o=new Map;function l(t){if("rule"===t.type){let e=Object.fromEntries(t.children.map(e=>[e.props,e.children]));for(let r of t.props){let t=Object.assign(o.get(r)??{},e);o.set(r,t)}}else if("@media"===t.type&&null!=e&&e.env){let r=function(e){let{width:t,height:r,dppx:n=1,widthPx:i=t,heightPx:a=r,deviceWidthPx:o=t*n,deviceHeightPx:s=r*n,...u}=e;return{widthPx:i,heightPx:a,deviceWidthPx:o,deviceHeightPx:s,dppx:n,...u}}(e.env),n=(Array.isArray(t.props)?t.props:[t.props]).map(e=>((e,t={})=>{let r=Je(e);if(ae(r))throw new Error(`Error parsing media query list: ${r.errid} at chars ${r.start}:${r.end}`);return Nt(r,t)})(e));for(let e of n)if(mt(e,r)){for(let e of t.children)l(e);return}}}for(let e of a)l(e);let s=new Map;for(let[e,t]of Array.from(o).sort(([e],[t])=>{let r=G$1(e),n=G$1(t);return r>n?1:n>r?-1:0})){let n=R$1(r,e);for(let e of n){let r=s.get(e)??{};s.set(e,Object.assign(r,t))}}for(let[e,r]of s){let n=e.attributes.style??"",i={};for(let e of fe(n))"decl"===e.type&&"string"==typeof e.props&&"string"==typeof e.children&&(i[e.props]=e.children);i=Object.assign({},r,i),e.attributes.style=t?i:`${Object.entries(i).map(([e,t])=>`${e}:${t.replace("!important","")};`).join("")}`}return r}}({useObjectSyntax:!0}),camelize=e=>e.replace(/-([a-z])/g,(e,t)=>t.toUpperCase());function html(e,...t){let r=function(e){let t,r,n,i,a,o,s,u,f,c="string"==typeof e?e:e.value,m=[];U.lastIndex=0,r=t={type:0,children:[]};let v=0;function h(){i=c.substring(v,U.lastIndex-n[0].length),i&&r.children.push({type:2,value:i,parent:r})}for(;n=U.exec(c);)if(o=n[5]||n[8],s=n[6]||n[9],u=n[7]||n[10],D.has(r.name)&&n[2]!==r.name)a=U.lastIndex-n[0].length,r.children.length>0&&(r.children[0].value+=n[0]);else{if("\x3c!--"===o){if(a=U.lastIndex-n[0].length,D.has(r.name))continue;f={type:3,value:s,parent:r,loc:[{start:a,end:a+o.length},{start:U.lastIndex-u.length,end:U.lastIndex}]},m.push(f),f.parent.children.push(f)}else if("<!"===o)a=U.lastIndex-n[0].length,f={type:4,value:s,parent:r,loc:[{start:a,end:a+o.length},{start:U.lastIndex-u.length,end:U.lastIndex}]},m.push(f),f.parent.children.push(f);else if("/"!==n[1]){if(h(),D.has(r.name)){v=U.lastIndex,h();continue}f={type:1,name:n[2]+"",attributes:I$1(n[3]),parent:r,children:[],loc:[{start:U.lastIndex-n[0].length,end:U.lastIndex}]},m.push(f),f.parent.children.push(f),n[4]&&n[4].indexOf("/")>-1||G.has(f.name)?(f.loc[1]=f.loc[0],f.isSelfClosingTag=!0):r=f}else h(),n[2]+""===r.name?(f=r,r=f.parent,f.loc.push({start:U.lastIndex-n[0].length,end:U.lastIndex}),i=c.substring(f.loc[0].end,f.loc[1].start),0===f.children.length&&f.children.push({type:2,value:i,parent:r})):n[2]+""===m[m.length-1].name&&!0===m[m.length-1].isSelfClosingTag&&(f=m[m.length-1],f.loc.push({start:U.lastIndex-n[0].length,end:U.lastIndex}));v=U.lastIndex}return i=c.slice(v),r.children.push({type:2,value:i,parent:r}),t}(H$1.call(null,e,...t).value.trim());Tt(r),(e=>{B$1(e,e=>{if(1===e.type&&e.attributes.class&&!e.attributes.tw){const t=e.attributes.class.split(/\s+/);let r=!1;for(const e of kt){if(r)break;for(const n of t){if(r)break;r=n.indexOf(":")>-1||("string"==typeof e?n.startsWith(e):e.test(n))}}r&&(e.attributes.tw=e.attributes.class)}})})(r);const n=new WeakMap;let i={type:"div",props:{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[]}};return B$1(r,(e,t,r)=>{let a={};if(0===e.type)n.set(e,i);else if(1===e.type){a.type=e.name;const{style:i,"":o,...s}=e.attributes;if("object"==typeof i){s.style={};for(const[e,t]of Object.entries(i))s.style[camelize(e)]=t}if(s.children=[],Object.assign(a,{props:s}),n.set(e,a),t){n.get(t).props.children[r]=a}}else if(2===e.type&&(a=e.value.trim(),a.trim()&&t)){const e=n.get(t);1===t.children.length?e.props.children=a:e.props.children[r]=a}}),i}function walkSatoriTree(e,t,r){const n=[];if(!t.props?.children||!Array.isArray(t.props.children))return n;if(0===t.props.children.length)return delete t.props.children,n;for(const i of t.props.children||[])if(i){for(const t of r.flat())t.filter(i)&&n.push(t.transform(i,e));n.push(...walkSatoriTree(e,i,r))}return n}const Et=[{filter:e=>!!e.props?.class&&!e.props?.tw,transform(e){e.props.tw=e.props.class,e.props.tw=e.props.tw.replace(/icon|inline-style/g,"")}},{filter:e=>!!e.props?.style?.display,transform(e){["inline-block","inline"].includes(e.props.style.display)&&delete e.props.style.display}}];function isEmojiFilter(e){return"svg"===e.type&&void 0!==e.props?.["data-emoji"]}const Ot=[{filter:e=>["div","p"].includes(e.type)&&Array.isArray(e.props?.children)&&e.props.children.some(isEmojiFilter),transform:e=>{e.props.style=e.props.style||{},e.props.style.display="flex",e.props.style.alignItems="center",e.props.children=e.props.children.map(e=>"string"==typeof e?{type:"div",props:{children:e}}:(e.props.class?.includes("emoji")&&delete e.props.class,e))}}],St=[{filter:e=>e.props?.["data-v-inspector"],transform:e=>{delete e.props["data-v-inspector"]}},{filter:e=>"string"==typeof e.props?.children,transform:t=>{t.props.children=e(t.props.children)}}],At=["div","p","ul","ol","li","blockquote","pre","hr","table","dl"],Ct=["span","a","b","i","u","em","strong","code","abbr","del","ins","mark","sub","sup","small","p","h1","h2","h3","h4","h5"],Bt={filter:e=>[...Ct,"div"].includes(e.type)&&Array.isArray(e.props?.children)&&e.props?.children.length>=1&&!e.props?.class?.includes("hidden"),transform:e=>{if(e.props.style=e.props.style||{},e.props.style?.display&&"flex"!==e.props.style?.display)return;if("div"===e.type&&(e.props.style.display="flex",!e.props?.class?.includes("flex-")&&Array.isArray(e.props.children)&&e.props.children.some(e=>At.includes(e.type))))return void(e.props.style.flexDirection="column");let t=e.props?.class?.includes("flex-wrap");e.props?.class?.includes("flex-")||(e.props.style.flexWrap="wrap",t=!0),t&&!e.props?.class?.includes("gap")&&(e.props.style.gap="0.2em")}};var Rt=new TextDecoder,toUTF8String=(e,t=0,r=e.length)=>Rt.decode(e.slice(t,r)),toHexString=(e,t=0,r=e.length)=>e.slice(t,r).reduce((e,t)=>e+`0${t.toString(16)}`.slice(-2),""),getView=(e,t)=>new DataView(e.buffer,e.byteOffset+t),readInt16LE=(e,t=0)=>getView(e,t).getInt16(0,!0),readUInt16BE=(e,t=0)=>getView(e,t).getUint16(0,!1),readUInt16LE=(e,t=0)=>getView(e,t).getUint16(0,!0),readUInt24LE=(e,t=0)=>{const r=getView(e,t);return r.getUint16(0,!0)+(r.getUint8(2)<<16)},readInt32LE=(e,t=0)=>getView(e,t).getInt32(0,!0),readUInt32BE=(e,t=0)=>getView(e,t).getUint32(0,!1),readUInt32LE=(e,t=0)=>getView(e,t).getUint32(0,!0),readUInt64=(e,t,r)=>getView(e,t).getBigUint64(0,!r),_t={readUInt16BE:readUInt16BE,readUInt16LE:readUInt16LE,readUInt32BE:readUInt32BE,readUInt32LE:readUInt32LE};function readUInt(e,t,r=0,n=!1){return _t[`readUInt${t}${n?"BE":"LE"}`](e,r)}function readBox(e,t){if(e.length-t<4)return;const r=readUInt32BE(e,t);return e.length-t<r?void 0:{name:toUTF8String(e,4+t,8+t),offset:t,size:r}}function findBox(e,t,r){for(;r<e.length;){const n=readBox(e,r);if(!n)break;if(n.name===t)return n;r+=n.size>0?n.size:8}}var $t={validate:e=>"BM"===toUTF8String(e,0,2),calculate:e=>({height:Math.abs(readInt32LE(e,22)),width:readUInt32LE(e,18)})};function getSizeFromOffset(e,t){const r=e[t];return 0===r?256:r}function getImageSize(e,t){const r=6+16*t;return{height:getSizeFromOffset(e,r+1),width:getSizeFromOffset(e,r)}}var Lt={validate(e){const t=readUInt16LE(e,0),r=readUInt16LE(e,4);if(0!==t||0===r)return!1;return 1===readUInt16LE(e,2)},calculate(e){const t=readUInt16LE(e,4),r=getImageSize(e,0);if(1===t)return r;const n=[];for(let r=0;r<t;r+=1)n.push(getImageSize(e,r));return{width:r.width,height:r.height,images:n}}},jt={validate(e){const t=readUInt16LE(e,0),r=readUInt16LE(e,4);if(0!==t||0===r)return!1;return 2===readUInt16LE(e,2)},calculate:e=>Lt.calculate(e)},Mt={validate:e=>542327876===readUInt32LE(e,0),calculate:e=>({height:readUInt32LE(e,12),width:readUInt32LE(e,16)})},Ft=/^GIF8[79]a/,Gt={validate:e=>Ft.test(toUTF8String(e,0,6)),calculate:e=>({height:readUInt16LE(e,8),width:readUInt16LE(e,6)})},Vt={avif:"avif",mif1:"heif",msf1:"heif",heic:"heic",heix:"heic",hevc:"heic",hevx:"heic"},Dt={validate(e){if("ftyp"!==toUTF8String(e,4,8))return!1;const t=findBox(e,"ftyp",0);if(!t)return!1;return toUTF8String(e,t.offset+8,t.offset+12)in Vt},calculate(e){const t=findBox(e,"meta",0),r=t&&findBox(e,"iprp",t.offset+12),n=r&&findBox(e,"ipco",r.offset+8);if(!n)throw new TypeError("Invalid HEIF, no ipco box found");const i=toUTF8String(e,8,12),a=[];let o=n.offset+8;for(;o<n.offset+n.size;){const t=findBox(e,"ispe",o);if(!t)break;const r=readUInt32BE(e,t.offset+12),i=readUInt32BE(e,t.offset+16),s=findBox(e,"clap",o);let u=r,f=i;if(s&&s.offset<n.offset+n.size){u=r-readUInt32BE(e,s.offset+12)}a.push({height:f,width:u}),o=t.offset+t.size}if(0===a.length)throw new TypeError("Invalid HEIF, no sizes found");return{width:a[0].width,height:a[0].height,type:i,...a.length>1?{images:a}:{}}}},Ut={ICON:32,"ICN#":32,"icm#":16,icm4:16,icm8:16,"ics#":16,ics4:16,ics8:16,is32:16,s8mk:16,icp4:16,icl4:32,icl8:32,il32:32,l8mk:32,icp5:32,ic11:32,ich4:48,ich8:48,ih32:48,h8mk:48,icp6:64,ic12:32,it32:128,t8mk:128,ic07:128,ic08:256,ic13:256,ic09:512,ic14:512,ic10:1024};function readImageHeader(e,t){const r=t+4;return[toUTF8String(e,t,r),readUInt32BE(e,r)]}function getImageSize2(e){const t=Ut[e];return{width:t,height:t,type:e}}var zt={validate:e=>"icns"===toUTF8String(e,0,4),calculate(e){const t=e.length,r=readUInt32BE(e,4);let n=8;const i=[];for(;n<r&&n<t;){const t=readImageHeader(e,n),r=getImageSize2(t[0]);i.push(r),n+=t[1]}if(0===i.length)throw new TypeError("Invalid ICNS, no sizes found");return{width:i[0].width,height:i[0].height,...i.length>1?{images:i}:{}}}},Wt={validate:e=>4283432785===readUInt32BE(e,0),calculate:e=>({height:readUInt32BE(e,12),width:readUInt32BE(e,8)})},Ht={validate(e){if("jP  "!==toUTF8String(e,4,8))return!1;const t=findBox(e,"ftyp",0);if(!t)return!1;return"jp2 "===toUTF8String(e,t.offset+8,t.offset+12)},calculate(e){const t=findBox(e,"jp2h",0),r=t&&findBox(e,"ihdr",t.offset+8);if(r)return{height:readUInt32BE(e,r.offset+8),width:readUInt32BE(e,r.offset+12)};throw new TypeError("Unsupported JPEG 2000 format")}};function isEXIF(e){return"45786966"===toHexString(e,2,6)}function extractSize(e,t){return{height:readUInt16BE(e,t),width:readUInt16BE(e,t+2)}}function validateExifBlock(e,t){const r=e.slice(2,t),n=toHexString(r,6,8),i="4d4d"===n;if(i||"4949"===n)return function(e,t){const r=readUInt(e,16,14,t);for(let n=0;n<r;n++){const r=16+12*n,i=r+12;if(r>e.length)return;const a=e.slice(r,i);if(274===readUInt(a,16,0,t)){if(3!==readUInt(a,16,2,t))return;if(1!==readUInt(a,32,4,t))return;return readUInt(a,16,8,t)}}}(r,i)}function validateInput(e,t){if(t>e.length)throw new TypeError("Corrupt JPG, exceeded buffer limits")}var qt={validate:e=>"ffd8"===toHexString(e,0,2),calculate(e){let t,r,n=e.slice(4);for(;n.length;){const e=readUInt16BE(n,0);if(validateInput(n,e),255===n[e]){if(isEXIF(n)&&(t=validateExifBlock(n,e)),r=n[e+1],192===r||193===r||194===r){const r=extractSize(n,e+5);return t?{height:r.height,orientation:t,width:r.width}:r}n=n.slice(e+2)}else n=n.slice(1)}throw new TypeError("Invalid JPG, no size found")}},Xt=class{constructor(e,t){this.input=e,this.endianness=t,this.byteOffset=2,this.bitOffset=0}getBits(e=1){let t=0,r=0;for(;r<e;){if(this.byteOffset>=this.input.length)throw new Error("Reached end of input");const n=this.input[this.byteOffset],i=8-this.bitOffset,a=Math.min(e-r,i);if("little-endian"===this.endianness){const e=(1<<a)-1;t|=(n>>this.bitOffset&e)<<r}else{t=t<<a|(n&(1<<a)-1<<8-this.bitOffset-a)>>8-this.bitOffset-a}r+=a,this.bitOffset+=a,8===this.bitOffset&&(this.byteOffset++,this.bitOffset=0)}return t}};function calculateImageDimension(e,t){if(t)return 8*(1+e.getBits(5));const r=[9,13,18,30][e.getBits(2)];return 1+e.getBits(r)}var Yt={validate:e=>"ff0a"===toHexString(e,0,2),calculate(e){const t=new Xt(e,"little-endian"),r=1===t.getBits(1),n=calculateImageDimension(t,r),i=t.getBits(3),a=function(e,t,r,n){return t&&0===r?8*(1+e.getBits(5)):0===r?calculateImageDimension(e,!1):Math.floor(n*[1,1.2,4/3,1.5,16/9,5/4,2][r-1])}(t,r,i,n);return{width:a,height:n}}};function extractCodestream(e){const t=findBox(e,"jxlc",0);if(t)return e.slice(t.offset+8,t.offset+t.size);const r=function(e){const t=[];let r=0;for(;r<e.length;){const n=findBox(e,"jxlp",r);if(!n)break;t.push(e.slice(n.offset+12,n.offset+n.size)),r=n.offset+n.size}return t}(e);return r.length>0?function(e){const t=e.reduce((e,t)=>e+t.length,0),r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}(r):void 0}var Qt={validate:e=>{if("JXL "!==toUTF8String(e,4,8))return!1;const t=findBox(e,"ftyp",0);if(!t)return!1;return"jxl "===toUTF8String(e,t.offset+8,t.offset+12)},calculate(e){const t=extractCodestream(e);if(t)return Yt.calculate(t);throw new Error("No codestream found in JXL container")}},Jt={validate:e=>{const t=toUTF8String(e,1,7);return["KTX 11","KTX 20"].includes(t)},calculate:e=>{const t=49===e[5]?"ktx":"ktx2",r="ktx"===t?36:20;return{height:readUInt32LE(e,r+4),width:readUInt32LE(e,r),type:t}}},Kt="CgBI",Zt={validate(e){if("PNG\r\n\n"===toUTF8String(e,1,8)){let t=toUTF8String(e,12,16);if(t===Kt&&(t=toUTF8String(e,28,32)),"IHDR"!==t)throw new TypeError("Invalid PNG");return!0}return!1},calculate:e=>toUTF8String(e,12,16)===Kt?{height:readUInt32BE(e,36),width:readUInt32BE(e,32)}:{height:readUInt32BE(e,20),width:readUInt32BE(e,16)}},er={P1:"pbm/ascii",P2:"pgm/ascii",P3:"ppm/ascii",P4:"pbm",P5:"pgm",P6:"ppm",P7:"pam",PF:"pfm"},tr={default:e=>{let t=[];for(;e.length>0;){const r=e.shift();if("#"!==r[0]){t=r.split(" ");break}}if(2===t.length)return{height:Number.parseInt(t[1],10),width:Number.parseInt(t[0],10)};throw new TypeError("Invalid PNM")},pam:e=>{const t={};for(;e.length>0;){const r=e.shift();if(r.length>16||r.charCodeAt(0)>128)continue;const[n,i]=r.split(" ");if(n&&i&&(t[n.toLowerCase()]=Number.parseInt(i,10)),t.height&&t.width)break}if(t.height&&t.width)return{height:t.height,width:t.width};throw new TypeError("Invalid PAM")}},rr={validate:e=>toUTF8String(e,0,2)in er,calculate(e){const t=toUTF8String(e,0,2),r=er[t],n=toUTF8String(e,3).split(/[\r\n]+/);return(tr[r]||tr.default)(n)}},nr={validate:e=>"8BPS"===toUTF8String(e,0,4),calculate:e=>({height:readUInt32BE(e,14),width:readUInt32BE(e,18)})},ir=/<svg\s([^>"']|"[^"]*"|'[^']*')*>/,ar={height:/\sheight=(['"])([^%]+?)\1/,root:ir,viewbox:/\sviewBox=(['"])(.+?)\1/i,width:/\swidth=(['"])([^%]+?)\1/},or=2.54,sr={in:96,cm:96/or,em:16,ex:8,m:96/or*100,mm:96/or/10,pc:96/72/12,pt:96/72,px:1},lr=new RegExp(`^([0-9.]+(?:e\\d+)?)(${Object.keys(sr).join("|")})?$`);function parseLength(e){const t=lr.exec(e);if(t)return Math.round(Number(t[1])*(sr[t[2]]||1))}function parseViewbox(e){const t=e.split(" ");return{height:parseLength(t[3]),width:parseLength(t[2])}}var ur={validate:e=>ir.test(toUTF8String(e,0,1e3)),calculate(e){const t=toUTF8String(e).match(ar.root);if(t){const e=function(e){const t=e.match(ar.width),r=e.match(ar.height),n=e.match(ar.viewbox);return{height:r&&parseLength(r[2]),viewbox:n&&parseViewbox(n[2]),width:t&&parseLength(t[2])}}(t[0]);if(e.width&&e.height)return function(e){return{height:e.height,width:e.width}}(e);if(e.viewbox)return function(e,t){const r=t.width/t.height;return e.width?{height:Math.floor(e.width/r),width:e.width}:e.height?{height:e.height,width:Math.floor(e.height*r)}:{height:t.height,width:t.width}}(e,e.viewbox)}throw new TypeError("Invalid SVG")}},fr={validate:e=>0===readUInt16LE(e,0)&&0===readUInt16LE(e,4),calculate:e=>({height:readUInt16LE(e,14),width:readUInt16LE(e,12)})},cr={WIDTH:256,HEIGHT:257,COMPRESSION:259},pr={SHORT:3,LONG:4,LONG8:16},dr={STANDARD:12,BIG:20},hr={STANDARD:2,BIG:8};function readTagValue(e,t,r,n){switch(t){case pr.SHORT:return readUInt(e,16,r,n);case pr.LONG:return readUInt(e,32,r,n);case pr.LONG8:{const t=Number(readUInt64(e,r,n));if(t>Number.MAX_SAFE_INTEGER)throw new TypeError("Value too large");return t}default:return 0}}function nextTag(e,t){const r=t?dr.BIG:dr.STANDARD;if(e.length>r)return e.slice(r)}var gr=new Set(["49492a00","4d4d002a","49492b00","4d4d002b"]);var mr=new Map([["bmp",$t],["cur",jt],["dds",Mt],["gif",Gt],["heif",Dt],["icns",zt],["ico",Lt],["j2c",Wt],["jp2",Ht],["jpg",qt],["jxl",Qt],["jxl-stream",Yt],["ktx",Jt],["png",Zt],["pnm",rr],["psd",nr],["svg",ur],["tga",fr],["tiff",{validate:e=>{const t=toHexString(e,0,4);return gr.has(t)},calculate(e){const t=function(e){const t=toUTF8String(e,0,2);return{isBigEndian:"MM"===t,isBigTiff:43===readUInt(e,16,2,"MM"===t)}}(e);t.isBigTiff&&function(e,t){const r=readUInt(e,16,4,t),n=readUInt(e,16,6,t);if(8!==r||0!==n)throw new TypeError("Invalid BigTIFF header")}(e,t.isBigEndian);const r=function(e,{isBigEndian:t,isBigTiff:r}){const n=r?Number(readUInt64(e,8,t)):readUInt(e,32,4,t),i=r?hr.BIG:hr.STANDARD;return e.slice(n+i)}(e,t),n=function(e,{isBigEndian:t,isBigTiff:r}){const n={};let i=e;for(;i?.length;){const e=readUInt(i,16,0,t),a=readUInt(i,16,2,t),o=r?Number(readUInt64(i,4,t)):readUInt(i,32,4,t);if(0===e)break;if(1===o&&(a===pr.SHORT||a===pr.LONG||r&&a===pr.LONG8)){const o=r?12:8;n[e]=readTagValue(i,a,o,t)}i=nextTag(i,r)}return n}(r,t),i={height:n[cr.HEIGHT],width:n[cr.WIDTH],type:t.isBigTiff?"bigtiff":"tiff"};if(n[cr.COMPRESSION]&&(i.compression=n[cr.COMPRESSION]),!i.width||!i.height)throw new TypeError("Invalid Tiff. Missing tags");return i}}],["webp",{validate(e){const t="RIFF"===toUTF8String(e,0,4),r="WEBP"===toUTF8String(e,8,12),n="VP8"===toUTF8String(e,12,15);return t&&r&&n},calculate(e){const t=toUTF8String(e,12,16),r=e.slice(20,30);if("VP8X"===t){const e=r[0];if(!(192&e)&&!(1&e))return function(e){return{height:1+readUInt24LE(e,7),width:1+readUInt24LE(e,4)}}(r);throw new TypeError("Invalid WebP")}if("VP8 "===t&&47!==r[0])return function(e){return{height:16383&readInt16LE(e,8),width:16383&readInt16LE(e,6)}}(r);const n=toHexString(r,3,6);if("VP8L"===t&&"9d012a"!==n)return function(e){return{height:1+((15&e[4])<<10|e[3]<<2|(192&e[2])>>6),width:1+((63&e[2])<<8|e[1])}}(r);throw new TypeError("Invalid WebP")}}]]),yr=Array.from(mr.keys()),vr=new Map([[0,"heif"],[56,"psd"],[66,"bmp"],[68,"dds"],[71,"gif"],[73,"tiff"],[77,"tiff"],[82,"webp"],[105,"icns"],[137,"png"],[255,"jpg"]]);var br={disabledTypes:[]};function imageSize(e){const t=function(e){const t=e[0],r=vr.get(t);return r&&mr.get(r).validate(e)?r:yr.find(t=>mr.get(t).validate(e))}(e);if(void 0!==t){if(br.disabledTypes.indexOf(t)>-1)throw new TypeError(`disabled file type: ${t}`);const r=mr.get(t).calculate(e);if(void 0!==r){if(r.type=r.type??t,r.images&&r.images.length>1){const e=r.images.reduce((e,t)=>t.width*t.height>e.width*e.height?t:e,r.images[0]);r.width=e.width,r.height=e.height}return r}}throw new TypeError(`unsupported file type: ${t}`)}const wr=[{filter:e=>"img"===e.type&&e.props?.src,transform:async(a,{e:o,publicStoragePath:s,runtimeConfig:u})=>{let f=a.props.src;const c=f.startsWith("/");let m,v;if(f.endsWith(".webp")&&t.warn("Using WebP images with Satori is not supported. Please consider switching image format or use the chromium renderer.",f),c){if(v||(v=await o.$fetch(f,{responseType:"arrayBuffer"}).catch(()=>{}),v||(v=await o.$fetch(f,{baseURL:r(o),responseType:"arrayBuffer"}).catch(()=>{}))),v){const e=v instanceof ArrayBuffer?v:v.buffer;a.props.src=n(e)}}else f.startsWith("data:")||(f=e(f),a.props.src=f,v=await $fetch(f,{responseType:"arrayBuffer"}).catch(()=>{}));if(v&&(!a.props.width||!a.props.height)){try{const e=imageSize(v);m={width:e.width,height:e.height}}catch{}if(m?.width&&m?.height){const e=m.width/m.height;a.props.width&&!a.props.height?a.props.height=Math.round(a.props.width/e):a.props.height&&!a.props.width?a.props.width=Math.round(a.props.height*e):a.props.width||a.props.height||(a.props.width=m.width,a.props.height=m.height)}}if("string"==typeof a.props.src&&a.props.src.startsWith("/"))if(v){const e=v instanceof ArrayBuffer?v:v.buffer;a.props.src=n(e)}else a.props.src=`${i(f,`${r(o)}`)}?${Date.now()}`}},{filter:e=>e.props?.style?.backgroundImage?.includes("url("),transform:async(e,{e:t,publicStoragePath:n,runtimeConfig:a})=>{const o=e.props.style.backgroundImage.replace(/^url\(['"]?/,"").replace(/['"]?\)$/,""),s=o?.startsWith("/");s&&(e.props.style.backgroundImage=`url(${i(o,`${r(t)}`)}?${Date.now()})`)}}],xr=[{filter:e=>"span"===e.type&&e.props?.class?.includes("iconify"),transform:(e,t)=>{}},{filter:e=>"svg"===e.type&&e.props?.class?.includes("iconify"),transform:e=>{e.props.class=String(e.props.class).split(" ").filter(e=>!e.startsWith("iconify")).join(" ")}}];function safeSplit(e){const[t,r]=e.split(":");return[String(t||"").trim(),String(r||"").trim()]}const Ir={filter:e=>!!e.props?.class,transform:async(e,t)=>{const r=e.props.class||"",n=e.props.style||{},i=new Set;for(const e of r.split(" ").filter(e=>e.trim())){const r=await t.unocss.parseToken(e);if(r){const t=String(r?.[0]?.[2]).split(";").filter(e=>!!e?.trim()),a={"--color-gray-50":"249 250 251","--color-gray-100":"243 244 246","--color-gray-200":"229 231 235","--color-gray-300":"209 213 219","--color-gray-400":"156 163 175","--color-gray-500":"107 114 128","--color-gray-600":"75 85 99","--color-gray-700":"55 65 81","--color-gray-800":"31 41 55","--color-gray-900":"17 24 39","--color-gray-950":"3 7 18"};t.filter(e=>e.startsWith("--")).forEach(e=>{const[t,r]=safeSplit(e);a[t]=r}),t.filter(e=>!e.startsWith("--")).forEach(e=>{const[t,r]=safeSplit(e),i=t.replace(/-([a-z])/g,(e,t)=>t.toUpperCase());if(n[i]||(n[i]=r.replace(/var\((.*?)\)/g,(e,t)=>a[t.trim()])),n[i]&&n[i].includes("/")){const[e,t]=n[i].split("/");e&&t&&("1)"===t.trim()?n[i]=e.replace(/(\d+) (\d+) (\d+).*/,(e,t,r,n)=>`${t}, ${r}, ${n})`):n[i]=`${e.replace("rgb","rgba").replaceAll(" ",", ")}${t.trim()}`)}}),i.add(e)}}e.props.class=r.split(" ").filter(e=>!i.has(e)).join(" "),e.props.tw=r.split(" ").filter(e=>!i.has(e)).join(" "),e.props.style=n}};async function applyInlineCss(e,t){const{e:r}=e;let n=t.html,i=t.head.style?.map(e=>e.innerHTML).filter(Boolean).join("\n")||"";const o=t.head.link?.filter(t=>t.href.startsWith("/_nuxt/components")&&t.href.replaceAll("/","").includes(e.options.component))||[];if(!o.length)return!1;if(!i.trim().length)return!1;const s=await async function(){return N.instance=N.instance||await import("./empty.mjs").then(e=>e.default),await N.instance.initWasmPromise,N.instance.cssInline}();if(!s||s?.__mock__){if(o.length){a().withTag("Nuxt OG Image").warn("To have inline styles applied you need to install either the `@css-inline/css-inline` or `@css-inline/css-inline-wasm` package.")}return!1}n=s.inline(t.html,{loadRemoteStylesheets:!1,extraCss:i});const u=i.match(/\.([\w-]+)/g)?.map(e=>e.replace(".",""));return u&&(n=n.replace(new RegExp(`class="(${u.join("|")})"`,"g"),"")),t.html=n,!0}async function createVNodes(e){let t=e.options.html;if(!t){const r=await o(e.e,e.options.component,void 0!==e.options.props?e.options.props:e.options);r.html=s(r.html),await applyInlineCss(e,r),await P(e,r),t=r.html,t?.includes("<body>")&&(t=t.match(/<body>([\s\S]*)<\/body>/)?.[1]||"")}const r=html(`<div style="position: relative; display: flex; margin: 0 auto; width: ${e.options.width}px; height: ${e.options.height}px; overflow: hidden;">${t}</div>`);return walkSatoriTree(e,r,[Ot,Et,Bt,St,xr]),await Promise.all(walkSatoriTree(e,r,[Ir,wr])),r}const kr={};async function resolveFonts(e){const{fonts:t}=u(),r=v([...e.options.fonts||[],...t]),n=[],i=[];if(T)for(const t of r)await T.hasItem(t.cacheKey)?(t.data=await T.getItemRaw(t.cacheKey)||void 0,i.push(t)):(kr[t.cacheKey]||(kr[t.cacheKey]=E(e,t).then(async e=>(e?.data&&await(T?.setItemRaw(e.cacheKey,e.data)),e))),n.push(kr[t.cacheKey]));const a=await Promise.all(n);return[...i,...a].map(e=>({name:e.name,data:e.data,style:e.style,weight:Number(e.weight)}))}async function createSvg(e){const{options:t}=e,{satoriOptions:r}=u(),[n,i,a]=await Promise.all([useSatori(),createVNodes(e),resolveFonts(e)]);await e._nitro.hooks.callHook("nuxt-og-image:satori:vnodes",i,e);return n(i,f(t.satori,r,{fonts:a,tailwindConfig:{theme:c},embedFont:!0,width:t.width,height:t.height})).catch(t=>m(e.e,t,!1))}async function createPng(e){const{resvgOptions:t}=u(),r=await createSvg(e);if(!r)throw new Error("Failed to create SVG");return new(await async function(){return $.instance=$.instance||await import("./wasm.mjs").then(e=>e.default),await $.instance.initWasmPromise,$.instance.Resvg}())(r,f(e.options.resvg,t)).render().asPng()}const Tr={name:"satori",supportedFormats:["png","jpeg","jpg","json"],async createImage(e){switch(e.extension){case"png":return createPng(e);case"jpeg":case"jpg":return async function(e){const{sharpOptions:t}=u();return console.error("Sharp dependency is not accessible. Please check you have it installed and are using a compatible runtime. Falling back to png."),createPng(e)}(e)}},async debug(e){const[t,r]=await Promise.all([createVNodes(e),createSvg(e)]);return{vnodes:t,svg:r}}};export{createSvg,Tr as default};
//# sourceMappingURL=renderer.mjs.map
