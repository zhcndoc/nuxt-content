import{ai as e,au as l,aj as a,av as t,ak as n,P as i,ao as r,aw as s,ax as u,aq as o,v as d,f as c,B as v,t as p,y as f}from"./server.mjs";import{f as m,h}from"../_/handleAndDispatchCustomEvent.mjs";import{aV as g,aQ as y,b4 as b,aS as k,bl as x,bm as C,bn as S,bo as K,aT as I,bq as V,bA as B,b5 as w,a$ as T,bj as A,bO as _,bU as q,bQ as L,c5 as $,bX as E,bV as N}from"../nitro/nitro.mjs";import{R}from"../_/RovingFocusItem.mjs";import W from"./CodeIcon-Du7BMZvL.mjs";import"node:buffer";import"node:events";import"node:process";import"node:timers";import"node:async_hooks";import"cloudflare:workers";import"node:path";function flatten(e){return e.reduce((e,l)=>(e.push(l),l.children&&e.push(...flatten(l.children)),e),[])}const[j,D]=e("TreeRoot");var O=y({__name:"TreeRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},items:{type:Array,required:!1},expanded:{type:Array,required:!1},defaultExpanded:{type:Array,required:!1},getKey:{type:Function,required:!0},getChildren:{type:Function,required:!1,default:e=>e.children},selectionBehavior:{type:String,required:!1,default:"toggle"},multiple:{type:Boolean,required:!1,skipCheck:!0},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},propagateSelect:{type:Boolean,required:!1},bubbleSelect:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"ul"}},emits:["update:modelValue","update:expanded"],setup(e,{emit:o}){const d=e,c=o,{items:v,multiple:p,disabled:f,propagateSelect:h,dir:y,bubbleSelect:A}=b(d),{handleTypeaheadSearch:_}=l(),q=a(y),L=g(),$=g(!1),E=t(),N=n(d,"modelValue",c,{defaultValue:d.defaultValue??(p.value?[]:void 0),passive:!0,deep:!0}),R=n(d,"expanded",c,{defaultValue:d.defaultExpanded??[],passive:void 0===d.expanded,deep:!0}),{onSelectItem:W,handleMultipleReplace:j}=function(e,l){const a=g();return{firstValue:a,onSelectItem:(t,n)=>{if(l.multiple&&Array.isArray(e.value))if("replace"===l.selectionBehavior)e.value=[t],a.value=t;else{const l=e.value.findIndex(e=>n(e));e.value=-1!==l?e.value.filter((e,a)=>a!==l):[...e.value,t]}else"replace"===l.selectionBehavior?e.value={...t}:!Array.isArray(e.value)&&n(e.value)?e.value=void 0:e.value={...t};return e.value},handleMultipleReplace:function(t,n,i,r){if(!a?.value||!l.multiple||!Array.isArray(e.value))return;const s=i().filter(e=>""!==e.ref.dataset.disabled),u=s.find(e=>e.ref===n)?.value;if(!u)return;let o=null;switch(t){case"prev":case"next":o=m(r,a.value,u);break;case"first":o=m(r,a.value,r?.[0]);break;case"last":o=m(r,a.value,r?.[r.length-1])}e.value=o}}}(N,d),O=k(()=>p.value&&Array.isArray(N.value)?N.value.map(e=>d.getKey(e)):[d.getKey(N.value??{})]);function flattenItems(e,l=1,a){return e.reduce((t,n,i)=>{const r=d.getKey(n),s=d.getChildren(n),u=R.value.includes(r),o={_id:r,value:n,index:i,level:l,parentItem:a,hasChildren:!!s,bind:{value:n,level:l,"aria-setsize":e.length,"aria-posinset":i+1}};return t.push(o),s&&u&&t.push(...flattenItems(s,l+1,n)),t},[])}const M=k(()=>{const e=d.items;return R.value.map(e=>e),flattenItems(e??[])});function handleKeydown(e){if($.value)E.trigger(e);else{const l=L.value?.getItems()??[];_(e.key,l)}}function handleKeydownNavigation(e){if($.value)return;const l=s[e.key];T(()=>{j(l,u(),L.value?.getItems,M.value.map(e=>e.value))})}function handleBubbleSelect(e){if(null!=e.parentItem&&Array.isArray(N.value)&&d.multiple){const l=M.value.find(l=>null!=e.parentItem&&d.getKey(l.value)===d.getKey(e.parentItem));if(null!=l){const e=d.getChildren(l.value)?.every(e=>N.value.find(l=>d.getKey(l)===d.getKey(e)));N.value=e?[...N.value,l.value]:N.value.filter(e=>d.getKey(e)!==d.getKey(l.value)),handleBubbleSelect(l)}}}return D({modelValue:N,selectedKeys:O,onSelect:e=>{const condition=l=>d.getKey(l??{})===d.getKey(e),l=d.multiple&&Array.isArray(N.value)?-1!==N.value?.findIndex(condition):void 0;if(W(e,condition),d.bubbleSelect&&d.multiple&&Array.isArray(N.value)){const l=M.value.find(l=>d.getKey(l.value)===d.getKey(e));null!=l&&handleBubbleSelect(l)}if(d.propagateSelect&&d.multiple&&Array.isArray(N.value)){const a=flatten(d.getChildren(e)??[]);N.value=l?[...N.value].filter(e=>!a.some(l=>d.getKey(e??{})===d.getKey(l))):[...N.value,...a]}},expanded:R,onToggle(e){if(!(e?d.getChildren(e):void 0))return;const l=d.getKey(e)??e;R.value.includes(l)?R.value=R.value.filter(e=>e!==l):R.value.push(l)},getKey:d.getKey,getChildren:d.getChildren,items:v,expandedItems:M,disabled:f,multiple:p,dir:q,propagateSelect:h,bubbleSelect:A,isVirtual:$,virtualKeydownHook:E,handleMultipleReplace:j}),(e,l)=>(C(),x(I(r),{ref_key:"rovingFocusGroupRef",ref:L,"as-child":"",orientation:"vertical",dir:I(q)},{default:S(()=>[K(I(i),{role:"tree",as:e.as,"as-child":e.asChild,"aria-multiselectable":!!I(p)||void 0,onKeydown:[handleKeydown,V(B(handleKeydownNavigation,["shift"]),["up","down"])]},{default:S(()=>[w(e.$slots,"default",{flattenItems:M.value,modelValue:I(N),expanded:I(R)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}});var M=y({inheritAttrs:!1,__name:"TreeItem",props:{value:{type:null,required:!0},level:{type:Number,required:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"li"}},emits:["select","toggle"],setup(e,{expose:l,emit:a}){const t=e,n=a,r=j(),{getItems:s}=o(),d=k(()=>!!r.getChildren(t.value)),c=k(()=>{const e=r.getKey(t.value);return r.expanded.value.includes(e)}),v=k(()=>{const e=r.getKey(t.value);return r.selectedKeys.value.includes(e)}),p=k(()=>{if(r.bubbleSelect.value&&d.value&&Array.isArray(r.modelValue.value)){const e=flatten(r.getChildren(t.value)||[]);return e.some(e=>r.modelValue.value.find(l=>r.getKey(l)===r.getKey(e)))&&!e.every(e=>r.modelValue.value.find(l=>r.getKey(l)===r.getKey(e)))}if(r.propagateSelect.value&&v.value&&d.value&&Array.isArray(r.modelValue.value)){return!flatten(r.getChildren(t.value)||[]).every(e=>r.modelValue.value.find(l=>r.getKey(l)===r.getKey(e)))}});function handleKeydownRight(e){if(d.value)if(c.value){const e=s().map(e=>e.ref),l=u(),a=e.indexOf(l),n=[...e].slice(a).find(e=>Number(e.getAttribute("data-indent"))===t.level+1);n&&n.focus()}else handleToggleCustomEvent(e)}function handleKeydownLeft(e){if(c.value)handleToggleCustomEvent(e);else{const e=s().map(e=>e.ref),l=u(),a=e.indexOf(l),n=[...e].slice(0,a).reverse().find(e=>Number(e.getAttribute("data-indent"))===t.level-1);n&&n.focus()}}async function handleSelect(e){n("select",e),e?.defaultPrevented||r.onSelect(t.value)}async function handleToggle(e){n("toggle",e),e?.defaultPrevented||r.onToggle(t.value)}async function handleSelectCustomEvent(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:c.value,isSelected:v.value};h("tree.select",handleSelect,l)}async function handleToggleCustomEvent(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:c.value,isSelected:v.value};h("tree.toggle",handleToggle,l)}return l({isExpanded:c,isSelected:v,isIndeterminate:p,handleToggle:()=>r.onToggle(t.value),handleSelect:()=>r.onSelect(t.value)}),(e,l)=>(C(),x(I(R),{"as-child":"",value:e.value,"allow-shift-key":""},{default:S(()=>[K(I(i),A(e.$attrs,{role:"treeitem",as:e.as,"as-child":e.asChild,"aria-selected":v.value,"aria-expanded":d.value?c.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":v.value?"":void 0,"data-expanded":c.value?"":void 0,onKeydown:[V(B(handleSelectCustomEvent,["self","prevent"]),["enter","space"]),l[0]||(l[0]=V(B(e=>"ltr"===I(r).dir.value?handleKeydownRight(e):handleKeydownLeft(e),["prevent"]),["right"])),l[1]||(l[1]=V(B(e=>"ltr"===I(r).dir.value?handleKeydownLeft(e):handleKeydownRight(e),["prevent"]),["left"]))],onClick:l[2]||(l[2]=B(e=>{handleSelectCustomEvent(e),handleToggleCustomEvent(e)},["stop"]))}),{default:S(()=>[w(e.$slots,"default",{isExpanded:c.value,isSelected:v.value,isIndeterminate:p.value,handleSelect:()=>I(r).onSelect(e.value),handleToggle:()=>I(r).onToggle(e.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}});const P={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},F=Object.assign({inheritAttrs:!1},{__name:"ProseCodeTree",__ssrInlineRender:!0,props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(e){const l=e,a=d.useSlots(),t=c(),[n,i]=v(),r=d.computed(()=>p({extend:p(P),...t.uiPro?.prose?.codeTree||{}})()),s=d.ref(l.defaultValue?{path:l.defaultValue}:void 0),u=d.ref(),o=d.ref(1),m=d.computed(()=>(o.value,a.default?.()?.flatMap(transformSlot).filter(Boolean)||[])),h=d.computed(()=>function(e){const l=new Map,a=[];e.forEach(e=>{const t=e.label.split("/");let n="";t.forEach((e,i)=>{if(n=n?`${n}/${e}`:e,!l.has(n)){const r={label:e,path:n,...i<t.length-1&&{children:[]}};l.set(n,r),0===i?a.push(r):l.get(t.slice(0,i).join("/"))?.children?.push(r)}})});const sort=e=>e.sort((e,l)=>!!e.children==!!l.children?e.label.localeCompare(l.label):l.children?1:-1).map(e=>({...e,children:e.children&&sort(e.children)}));return sort(a)}(m.value));function transformSlot(e,l){return"symbol"==typeof e.type?e.children?.map(transformSlot):{label:e.props?.filename||e.props?.label||`${l}`,icon:e.props?.icon,component:e}}const g=d.computed(()=>{if(l.expandAll){const e=new Set;return m.value.forEach(l=>{const a=l.label.split("/");for(let l=1;l<a.length;l++)e.add(a.slice(0,l).join("/"))}),Array.from(e)}const e=s.value?.path;if(!e)return[];const a=e.split("/");return a.map((e,l)=>a.slice(0,l+1).join("/"))});return d.watch(s,e=>{const l=m.value.find(l=>e?.path===l.label);l?.component&&(u.value=l)},{immediate:!0}),(e,a,o,c)=>{a("\x3c!--[--\x3e"),a(_(d.unref(n),null,{default:d.withCtx(({items:e,level:a},n,s,u)=>{if(!n)return[(d.openBlock(!0),d.createBlock(d.Fragment,null,d.renderList(e,(e,n)=>(d.openBlock(),d.createBlock("li",{key:`${a}-${n}`,class:a>0?r.value.itemWithChildren({class:l.ui?.itemWithChildren}):r.value.item({class:l.ui?.item})},[d.createVNode(d.unref(M),{"as-child":"",level:a,value:e},{default:d.withCtx(({isExpanded:n,isSelected:s})=>[d.createVNode("button",{class:r.value.link({class:l.ui?.link,active:s})},[e.children?.length?(d.openBlock(),d.createBlock(f,{key:0,name:n?d.unref(t).ui.icons.folderOpen:d.unref(t).ui.icons.folder,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,8,["name","class"])):(d.openBlock(),d.createBlock(W,{key:1,filename:e.label,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,8,["filename","class"])),d.createVNode("span",{class:r.value.linkLabel({class:l.ui?.linkLabel})},d.toDisplayString(e.label),3),e.children?.length?(d.openBlock(),d.createBlock("span",{key:2,class:r.value.linkTrailing({class:l.ui?.linkTrailing})},[d.createVNode(f,{name:d.unref(t).ui.icons.chevronDown,class:r.value.linkTrailingIcon({class:l.ui?.linkTrailingIcon})},null,8,["name","class"])],2)):d.createCommentVNode("",!0)],2),e.children?.length&&n?(d.openBlock(),d.createBlock("ul",{key:0,class:r.value.listWithChildren({class:l.ui?.listWithChildren})},[d.createVNode(d.unref(i),{items:e.children,level:a+1},null,8,["items","level"])],2)):d.createCommentVNode("",!0)]),_:2},1032,["level","value"])],2))),128))];n("\x3c!--[--\x3e"),q(e,(e,o)=>{n(`<li class="${L(a>0?r.value.itemWithChildren({class:l.ui?.itemWithChildren}):r.value.item({class:l.ui?.item}))}"${u}>`),n(_(d.unref(M),{"as-child":"",level:a,value:e},{default:d.withCtx(({isExpanded:n,isSelected:s},u,o,c)=>{if(!u)return[d.createVNode("button",{class:r.value.link({class:l.ui?.link,active:s})},[e.children?.length?(d.openBlock(),d.createBlock(f,{key:0,name:n?d.unref(t).ui.icons.folderOpen:d.unref(t).ui.icons.folder,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,8,["name","class"])):(d.openBlock(),d.createBlock(W,{key:1,filename:e.label,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,8,["filename","class"])),d.createVNode("span",{class:r.value.linkLabel({class:l.ui?.linkLabel})},d.toDisplayString(e.label),3),e.children?.length?(d.openBlock(),d.createBlock("span",{key:2,class:r.value.linkTrailing({class:l.ui?.linkTrailing})},[d.createVNode(f,{name:d.unref(t).ui.icons.chevronDown,class:r.value.linkTrailingIcon({class:l.ui?.linkTrailingIcon})},null,8,["name","class"])],2)):d.createCommentVNode("",!0)],2),e.children?.length&&n?(d.openBlock(),d.createBlock("ul",{key:0,class:r.value.listWithChildren({class:l.ui?.listWithChildren})},[d.createVNode(d.unref(i),{items:e.children,level:a+1},null,8,["items","level"])],2)):d.createCommentVNode("",!0)];u(`<button class="${L(r.value.link({class:l.ui?.link,active:s}))}"${c}>`),e.children?.length?u(_(f,{name:n?d.unref(t).ui.icons.folderOpen:d.unref(t).ui.icons.folder,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,o,c)):u(_(W,{filename:e.label,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,o,c)),u(`<span class="${L(r.value.linkLabel({class:l.ui?.linkLabel}))}"${c}>${$(e.label)}</span>`),e.children?.length?(u(`<span class="${L(r.value.linkTrailing({class:l.ui?.linkTrailing}))}"${c}>`),u(_(f,{name:d.unref(t).ui.icons.chevronDown,class:r.value.linkTrailingIcon({class:l.ui?.linkTrailingIcon})},null,o,c)),u("</span>")):u("\x3c!----\x3e"),u("</button>"),e.children?.length&&n?(u(`<ul class="${L(r.value.listWithChildren({class:l.ui?.listWithChildren}))}"${c}>`),u(_(d.unref(i),{items:e.children,level:a+1},null,o,c)),u("</ul>")):u("\x3c!----\x3e")}),_:2},s,u)),n("</li>")}),n("\x3c!--]--\x3e")}),_:1},o)),a(`<div${E(d.mergeProps(e.$attrs,{class:r.value.root({class:[l.ui?.root,l.class]})}))}>`),a(_(d.unref(O),{modelValue:s.value,"onUpdate:modelValue":e=>s.value=e,class:r.value.list({class:l.ui?.list}),items:h.value,"get-key":e=>e.path,"default-expanded":g.value},{default:d.withCtx((e,l,a,t)=>{if(!l)return[d.createVNode(d.unref(i),{items:h.value,level:0},null,8,["items"])];l(_(d.unref(i),{items:h.value,level:0},null,a,t))}),_:1},o)),a(`<div class="${L(r.value.content({class:l.ui?.content}))}">`),N(a,d.createVNode(d.resolveDynamicComponent(u.value?.component),null,null),o),a("</div></div>\x3c!--]--\x3e")}}}),z=F.setup;F.setup=(e,l)=>{const a=d.useSSRContext();return(a.modules||(a.modules=new Set)).add("../../node_modules/.pnpm/@nuxt+ui-pro@3.3.3_@babel+parser@7.28.4_change-case@5.4.4_db0@0.3.2_@electric-sql+pglit_506d3e6c3d060cad1256bab0b75e89ac/node_modules/@nuxt/ui-pro/dist/runtime/components/prose/CodeTree.vue"),z?z(e,l):void 0};export{F as default};
//# sourceMappingURL=CodeTree-CPAT-pzO.mjs.map
